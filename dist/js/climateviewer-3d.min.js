"use strict";function resize(){var e=$(window).height(),a=$(window).width(),i=420;$("html").height(e).width(a),$("body").height(e).width(a),$("#top").slimScroll({height:e-30}),i>a?($("#cesiumContainer, .cesium-viewer, .control-sidebar").height(e).width(a),$("#options-menu").addClass("show")):($("#cesiumContainer, .cesium-viewer").height(e).width(a),$(".control-sidebar").height(e).width(i),$("#options-menu").removeClass("show"))}function toggleTimeline(e){if(e)animationContainer.show(),timelineContainer.addClass("show"),$("#toggle-timeline").addClass("active");else if(timelineContainer.is(":visible"))animationContainer.hide(),timelineContainer.removeClass("show"),$("#toggle-timeline").removeClass("active");else{animationContainer.show(),timelineContainer.addClass("show");var a=Cesium.JulianDate.fromDate(new Date(Date.UTC(2012,4,8))),i=Cesium.JulianDate.now();viewer.timeline.zoomTo(a,i),$("#toggle-timeline").addClass("active")}}function getURLParameter(e){for(var a=decodeURIComponent(window.location.search.substring(1)),i=a.split("&"),r=0;r<i.length;r++){var t=i[r].split("=");if(t[0]==e)return t[1]}}function loading(e){$("."+e+"-load").removeClass("fa-play").addClass("fa-spinner fa-spin loading active")}function loaded(e){$("."+e+"-load").removeClass("fa-spinner fa-spin loading").addClass("fa-check")}function loadError(e,a,i){var r=$("#"+e);$('<div class="details"><div class="header"><i class="fa fa-fw fa-exclamation-circle"></i> Load Failed</div>Please use <a href="mailto:jim@climateviewer.com?subject=Climate Viewer 3D broken link - '+e+"&amp;body=Unfortunately this ( "+a+' ) URL is not working properly, please look into it.  Sent from http://climateviewer.org/3D/" target="_self">this link</a> to report this error.<br><div class="darkwell"><strong>ERROR:</strong> '+i+"</div></div>").appendTo(r);var t=$("."+e+"-load"),s=$("#"+e+" span");t.removeClass("fa-spinner fa-spin active loading").addClass("fa-exclamation-triangle fail"),s.removeClass("active").addClass("fail")}function NSlider(e){var a=e.src,i=e.mod;e=e||{},e.element||(e.element=$('<div class="item slider"></div>')),e.min||(e.min=0),e.max||(e.max=1),e.start||(e.start=1),e.label||(e.label=""),$('<div class="label">'+e.label+"</div>").appendTo(e.element);var r=$('<input class="'+e.label+'" type="range">').appendTo(e.element),t=e.start/e.max*100;return r.attr("min",0),r.attr("max",100),r.attr("step",1),r.attr("value",t),r.on("change",function(){var t=r.val(),s=(t/100).toFixed(2),o=e.max*s;if(i)for(var l=a.entities.values,n=0;n<l.length;n++){var d=l[n],c=d.billboard.color;"alpha"==i&&(d.billboard.color=new Cesium.Color.fromAlpha(c,o))}else"opacity"==e.label&&(a.alpha=o),"contrast"==e.label&&(a.contrast=o),"saturation"==e.label&&(a.saturation=o),"brightness"==e.label&&(a.brightness=o),"gamma"==e.label&&(a.gamma=o)}),e.element}function loadSliders(e,a){var i=$("#"+a+" .lb"),r=$('<div class="details '+a+'-sliders layer-sliders" />').insertAfter(i),t=$('<div class="slider-content" />').appendTo(r),s=$('<div class="ui divided list" />').appendTo(t);NSlider({label:"opacity",src:e}).appendTo(s),NSlider({max:2,label:"brightness",src:e}).appendTo(s),NSlider({max:2,label:"contrast",src:e}).appendTo(s),NSlider({max:2,label:"saturation",src:e}).appendTo(s),e.alpha=1,e.brightness=1,e.contrast=1,e.saturation=1,loaded(a)}function loadGIBS(e,a,i,r){removeImagery(e);var t=viewer.imageryLayers.addImageryProvider(new Cesium.WebMapTileServiceImageryProvider({url:"http://gibs.earthdata.nasa.gov/wmts/epsg3857/best/wmts.cgi?TIME="+a,layer:e,style:"",format:i,tileMatrixSetID:"GoogleMapsCompatible_Level"+r,minimumLevel:0,maximumLevel:r,tileWidth:256,tileHeight:256,tilingScheme:new Cesium.WebMercatorTilingScheme}));activeLayers[e]=t,$("."+e+"-sliders").remove(),loadSliders(t,e)}function loadWmts(e,a,i){var r=viewer.imageryLayers.addImageryProvider(new Cesium.WebMapTileServiceImageryProvider({url:a,layers:i,style:"",format:"image/png",tileMatrixSetID:"GoogleMapsCompatible_Level9",maximumLevel:9,tileWidth:256,tileHeight:256,tilingScheme:new Cesium.WebMercatorTilingScheme}));activeLayers[e]=r,loadSliders(r,e)}function loadWms(e,a,i,r){var t;t=r?viewer.imageryLayers.addImageryProvider(new Cesium.WebMapServiceImageryProvider({url:a,layers:i,sourceUri:a,enablePickFeatures:!1,tilingScheme:new Cesium.WebMercatorTilingScheme,parameters:{transparent:!0,format:"image/png"}})):viewer.imageryLayers.addImageryProvider(new Cesium.WebMapServiceImageryProvider({url:a,layers:i,sourceUri:a,tilingScheme:new Cesium.WebMercatorTilingScheme,parameters:{transparent:!0,format:"image/png"}})),activeLayers[e]=t,loadSliders(t,e)}function loadOsmLayer(e,a){var i=viewer.imageryLayers.addImageryProvider(new Cesium.createOpenStreetMapImageryProvider({url:a}));activeLayers[e]=i,loadSliders(i,e)}function loadCartoDB(e,a){var i=viewer.imageryLayers.addImageryProvider(new Cesium.UrlTemplateImageryProvider({url:a}));activeLayers[e]=i,loadSliders(i,e)}function loadBingLayer(e,a){var i,r="//dev.virtualearth.net",t="AiQDjsWpddVOFEnVY6j4Jb0S0Hoy9QMa30rvbZT1A8qd0it10NkYAgvb5sa3OeLw";i="AERIAL"==a?viewer.imageryLayers.addImageryProvider(new Cesium.BingMapsImageryProvider({url:r,key:t,mapStyle:Cesium.BingMapsStyle.AERIAL})):"AERIAL_WITH_LABELS"==a?viewer.imageryLayers.addImageryProvider(new Cesium.BingMapsImageryProvider({url:r,key:t,mapStyle:Cesium.BingMapsStyle.AERIAL_WITH_LABELS})):viewer.imageryLayers.addImageryProvider(new Cesium.BingMapsImageryProvider({url:r,key:t,mapStyle:Cesium.BingMapsStyle.ROADS})),activeLayers[e]=i,loadSliders(i,e)}function newMarkerLabel(e,a){var i=new Cesium.LabelGraphics;return"usgs-eq"==a?i.text="M"+e.properties.mag:e.label.text?i.text=e.label.text:i.text="",i.horizontalOrigin=Cesium.HorizontalOrigin.CENTER,i.verticalOrigin=Cesium.VerticalOrigin.BOTTOM,i.outlineWidth=5,i.style=Cesium.LabelStyle.FILL_AND_OUTLINE,i.translucencyByDistance=defaultTranslucency,i.eyeOffset=defaultKMLEyeOffset,i}function modMarkers(e,a,i,r,t,s){var o,l;if(s===!1){var n=$("."+e+"-details");l=$('<div class="details '+e+'-list marker-list" />').insertAfter(n),o=[]}for(var d=a.entities.values,c=0;c<d.length;c++){var m=d[c];console.log(m);var v,u=new Cesium.BillboardGraphics;v=i?i:m.billboard.image?m.billboard.image:"dist/img/icons/cv3d.png",u.image=v;var p;p="usgs-eq"==t?m.properties.mag:r?r:3;var f,g;if(f=m.properties.title?"<h3>"+m.properties.title+"</h3>":m.properties.Name?"<h3>"+m.properties.Name+"</h3>":m.properties.name?"<h3>"+m.properties.name+"</h3>":m.properties.LICENSEE?"<h3>"+m.properties.LICENSEE+"</h3>":"",g=m.properties.mag?"<div>Place: "+m.properties.place+"<br>Magnitude: "+m.properties.mag+'<br><a href="'+m.properties.url+'" target="_blank">Click here for more info.</a></div>':m.properties.Description?"<div>"+m.properties.Description+"</div>":m.properties.description?"<div>"+m.properties.description+"</div>":m.properties.desc?"<div>"+m.properties.desc+"</div>":m.properties.FREQUENCY?"<div>FREQUENCY: "+m.properties.FREQUENCY+"<br>CALLSIGN: "+m.properties.CALLSIGN+"<br>SERVICE: "+m.properties.SERVICE+"<br></div>":"",m.title=f,m.description=g,u.scale=p,u.width=32,u.height=32,u.alignedAxis=Cesium.Cartesian3.ZERO,u.scaleByDistance=defaultScaleByDistance,m.billboard=u,s===!1){var h=m.position.getValue(),y=Cesium.Ellipsoid.WGS84.cartesianToCartographic(h),w=Cesium.Math.toDegrees(y.longitude),b=Cesium.Math.toDegrees(y.latitude);o.push('<li data-lon="'+w+'"  data-lat="'+b+'">'+m.title+"</li>")}t&&(m.label=newMarkerLabel(m,t))}s===!1&&($('<h5><i class="fa fa-fw fa-map-marker"></i> Map Markers</h5>').appendTo(l),$("<ol/>",{"class":"markers",html:o.join("")}).appendTo(l),$(".markers li").click(function(){var e=$(this).attr("data-lon"),a=$(this).attr("data-lat");viewer.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(e,a,3e3)})}))}function modMRM(e){for(var a=e.entities.values,i=0;i<a.length;i++){var s,r=a[i],t=new Cesium.BillboardGraphics;s=r.billboard.image?r.billboard.image:"dist/img/icons/cv3d.png",t.image=s,t.scale=4,t.width=32,t.height=32,t.alignedAxis=Cesium.Cartesian3.ZERO,t.scaleByDistance=defaultScaleByDistance,r.billboard=t}}function loadArcGisLayer(e,a,i,r,t){var s;s=r?viewer.imageryLayers.addImageryProvider(new Cesium.ArcGisMapServerImageryProvider({url:a,format:t,enablePickFeatures:!1,layers:i,tilingScheme:new Cesium.WebMercatorTilingScheme})):viewer.imageryLayers.addImageryProvider(new Cesium.ArcGisMapServerImageryProvider({url:a,format:t,enablePickFeatures:!0,layers:i,tilingScheme:new Cesium.WebMercatorTilingScheme})),activeLayers[e]=s,loadSliders(s,e),loaded(e)}function loadGeoJson(e,a,i,r,t,s,o){new Cesium.GeoJsonDataSource.load(a).then(function(a){modMarkers(e,a,t,r,i,o),viewer.dataSources.add(a),activeLayers[e]=a,s&&(s===!0?viewer.flyTo(a):$(".cesium-home-button").trigger("click")),loaded(e)},function(i){loadError(e,a,i)})}function loadKml(e,a,i,r,t,s,o,l){i?new Cesium.KmlDataSource.load(a,{proxy:{getURL:function(e){return proxyURL+encodeURIComponent(e)}},sourceUri:a}).then(function(a){l&&modMarkers(a,t,s,o),viewer.dataSources.add(a),activeLayers[e]=a,loaded(e)},function(i){loadError(e,a,i)}):new Cesium.KmlDataSource.load(a).then(function(a){l&&modMarkers(a,t,s,o),viewer.dataSources.add(a),activeLayers[e]=a,loaded(e)},function(i){loadError(e,a,i)})}function removeImagery(e){var a=activeLayers[e];delete activeLayers[e],viewer.imageryLayers.remove(a,!1)}function disableLayer(e){var a=e.I,i=e.T;if(void 0!==layerEnabled[e.I]){if("nasa-gibs"===i||"cartodb-layer"===i||"wmts"===i||"wms"===i||"base-layer"===i||"arcgis-layer"===i||"arcgis-base-layer"===i||"bing"===i)removeImagery(a),$("."+a+"-sliders").remove();else{var r=activeLayers[a];delete activeLayers[a],viewer.dataSources.remove(r)}("geojson"===i||"kml"===i)&&($("."+a+"-tree").removeClass("active"),$("."+a+"-list").remove()),delete layerEnabled[a]}}function updateLayer(e,a){loading(e);var i=me.node(e);i||console.error("missing layer",e);var f,r=i.G,t=i.L,s=i.M,o=i.MI,l=i.MS,n=i.ML,d=i.C,c=i.Y,m=i.F,u=i.Fz,v=i.P,p=i.X,g=picker.get("select","yyyy-mm-dd");a||(f=i.Z),t=t?t:"0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,",u=u?u:"9",m="jpg"===m?"image/jpeg":"image/png",c=c?!0:!1,void 0===layerEnabled[e]&&(layerEnabled[e]=!1,"wms"===i.T?loadWms(e,r,t,p):"nasa-gibs"===i.T?loadGIBS(e,g,m,u):"wmts"===i.T?loadWmts(e,r,t):"cartodb-layer"===i.T?loadCartoDB(e,r):"base-layer"===i.T?loadOsmLayer(e,r):"arcgis-layer"===i.T||"arcgis-base-layer"===i.T?loadArcGisLayer(e,r,t,p,m):"geojson"===i.T?loadGeoJson(e,r,n,l,o,f,c):"kml"===i.T?loadKml(e,r,v,f,o,l,n,s):"bing"===i.T?loadBingLayer(e,r):console.log(e+" failed to load map type: "+i.T),d&&toggleTimeline(!0))}function newFolderLabel(e,a,i){var r;r=i?'<i class="fa fa-fw '+i+'"></i>':"";var t=$("<h2>").addClass("toggle").html(r+e.N).click(function(){a.is(":visible")?(a.hide(),t.removeClass("active")):(a.show(),t.addClass("active"))});return t}function initDetails(e,a,i,r,t,s){var o=$('<div class="details '+e+'-content" />').appendTo(i);$('<div class="header"><i class="fa fa-fw fa-info-circle"></i> Layer Details</div><span>'+r+' &bull; <a href="'+t+'" target="_blank" rel="nofollow">More Info</a></span>').appendTo(o),"kml"==a&&$('<div class="header"><i class="fa fa-fw fa-download"></i> Data Source</div><span>Keyhole Markup Language (KML) &bull; <a href="'+s+'">Download</a></span>').appendTo(o),"geojson"==a&&$('<div class="header"><i class="fa fa-fw fa-download"></i> Data Source</div><span>GeoJSON &bull; <a href="'+s+'">Download</a></span>').appendTo(o),"nasa-gibs"==a&&$('<div class="header"><i class="fa fa-fw fa-file-o"></i> Data Source</div><span>Web Map Tile Service (WMTS)</span>').appendTo(o),"wms"==a&&$('<div class="header"><i class="fa fa-fw fa-file-o"></i> Data Source</div><span>Web Mapping Service (WMS)<br><a target="_blank" rel="nofollow" href="'+s+'?request=GetCapabilities&service=WMS">Get Capabilities</a></span>').appendTo(o),"base-layer"==a&&$('<div class="header"><i class="fa fa-fw fa-file-o"></i> Data Source</div><span>OpenStreetMap (OSM) Base Map</span>').appendTo(o),("arcgis-layer"==a||"arcgis-base-layer"==a)&&$('<div class="header"><i class="fa fa-fw fa-file-o"></i> Data Source</div><span>ArcGIS MapServer<br><a target="_blank" rel="nofollow" href="'+s+'/legend">Map Legend</a> &bull; <a target="_blank" rel="nofollow" href="'+s+'">MapServer Information</a></span>>').appendTo(o),$('<div class="header"><i class="fa fa-share-square-o fa-fw"></i> Share This Layer</div><span>Use this url to share this layer: <a href="'+homeURL+"index.html?layersOn="+e+'" target="_self">Share Link</a></span><div class="header"><i class="fa fa-exclamation-triangle fa-fw"></i> Report Error</div><span>If you are experiencing problems loading this layer, or you would like to suggest corrections, comments, or concerns, please email me using this link: <a href="mailto:jim@climateviewer.com?subject=Climate Viewer broken link - '+e+"&amp;body=Unfortunately this ( "+s+' ) URL is not working properly, please look into it. Sent from http://climateviewer.org/3D/" target="_self">Report Error</a></span>').appendTo(o)}function addTree(e,a,i){var r=me.successors(e);return _.each(r,function(e){var t,r=me.node(e),s=r.I,o=r.T,l=$('<div class="folder" />').html(r);if(r.T){var d=!0;if(d){var w,b,C,T,L,M,S,c=r.G,m=r.S,u=r.U,v=r.H,p=r.NL,f=r.C,g=r.F,h=r.Fz,y=r.Y;y!==!0&&(y=!1),h=h?h:"9",g="jpg"===g?"image/jpeg":"image/png",t=g?$("<div>").data("l",r).attr({id:r.I,"data-format":g,"data-zoom":h}).addClass("lbw "+r.T):$("<div>").data("l",r).attr("id",r.I).addClass("lbw "+r.T),w=$("<div>").addClass("lb").appendTo(t),T=$("<i>").addClass("fa fa-fw fa-folder-o").toggle(function(){0===b.children().length&&initDetails(s,o,b,m,u,c),b.show(),b.focus(),T.removeClass("fa-folder-o").addClass("fa-folder-open-o active")},function(){b.hide(),T.removeClass("fa-folder-open-o active").addClass("fa-folder-o")}).appendTo(w),"geojson"===r.T&&y===!1&&(L=$('<i title="Expand Marker Tree" class="fa fa-fw fa-sitemap toggle-list '+s+'-tree"></i>'),L.click(function(){setTimeout(function(){$("."+s+"-list").is(":visible")?($("."+s+"-list").hide(),L.removeClass("active")):($("."+s+"-list").show(),L.addClass("active"))})}).appendTo(w)),("nasa-gibs"===r.T||"cartodb-layer"===r.T||"wmts"===r.T||"wms"===r.T||"base-layer"===r.T||"arcgis-layer"===r.T||"arcgis-base-layer"===r.T||"bing"===r.T)&&(M=$('<i title="Expand Marker Tree" class="fa fa-fw fa-sliders toggle-list '+s+'-tree"></i>'),M.click(function(){setTimeout(function(){$("."+s+"-sliders").is(":visible")?($("."+s+"-sliders").hide(),M.removeClass("show-sliders")):($("."+s+"-sliders").show(),M.addClass("show-sliders"))})}).appendTo(w)),C=$('<i class="fa fa-fw fa-play '+s+'-load"></i>'),v&&C.addClass("large-layer"),p&&C.addClass("new-layer"),C.toggle(function(){setTimeout(function(){C.hasClass("fa-play")&&(i?updateLayer(s,i):updateLayer(s),S.hasClass("active")||S.addClass("active"),t.hasClass("active")||t.addClass("active"),f&&toggleTimeline(!0),"geojson"===r.T&&y===!1&&L.show(),("nasa-gibs"===r.T||"cartodb-layer"===r.T||"wmts"===r.T||"wms"===r.T||"base-layer"===r.T||"arcgis-layer"===r.T||"arcgis-base-layer"===r.T||"bing"===r.T)&&M.show())})},function(){setTimeout(function(){C.hasClass("fa-check")&&(disableLayer(r),C.removeClass("fa-check active").addClass("fa-play"),S.hasClass("active")&&S.removeClass("active"),t.hasClass("active")&&t.removeClass("active"),T.hasClass("fa-folder-open-o")&&T.trigger("click"),"geojson"===r.T&&y===!1&&L.hide(),("nasa-gibs"===r.T||"cartodb-layer"===r.T||"wmts"===r.T||"wms"===r.T||"base-layer"===r.T||"arcgis-layer"===r.T||"arcgis-base-layer"===r.T||"bing"===r.T)&&(M.hide(),M.removeClass("show-sliders")))})}).appendTo(w),S=$("<span>").html(r.N).addClass("label"),S.toggle(function(){S.hasClass("fail")||(S.hasClass("active")||S.addClass("active"),C.trigger("click"))},function(){S.hasClass("fail")||(S.hasClass("active")&&S.removeClass("active"),C.trigger("click"))}).appendTo(w),b=$('<div class="'+s+'-details layer-details" />').appendTo(t),b.hide()}}else{var n=r.icon;t=newFolderLabel(r,l,n)}if(null!==t){a.append(t);var k=addTree(r.I,l,i);k.length&&a.append(l)}}),r}function initLayers(e){var a=$("#map-layers");a.addClass("ui"),e?_.each(me.sources(),function(i){addTree(i,a,e)}):_.each(me.sources(),function(e){addTree(e,a)})}function shareLink(){var e="",i=shareURL;if($(".lbw.active").each(function(){var a=$(this).attr("id");e+=a+","}),i+="index.html?",e.length>0&&(e=e.substring(0,e.length-1),i+="layersOn="+e),i+="&baseLayer="+$(".cesium-baseLayerPicker-selectedItem").prop("id"),$("#mode-2D").hasClass("active"))i+="&mode=2D";else{var r=viewer.scene,t=r.camera,s=new Cesium.Cartesian2(viewer.container.clientWidth/2,viewer.container.clientHeight/2),o=viewer.scene.camera.getPickRay(s),l=viewer.scene.globe.pick(o,viewer.scene),n=viewer.scene.globe.ellipsoid.cartesianToCartographic(l),d=t.positionCartographic.height,c=n.longitude*(180/Math.PI),m=n.latitude*(180/Math.PI),u=c.toFixed(5),v=m.toFixed(5),p=d.toFixed(2);i+="&lat="+u,i+="&lon="+v,i+="&zoom="+p,i+="&mode=3D"}var f=picker.get("select","yyyy-mm-dd");i+="&date="+f;var g=$(".share-all-layers");g.attr("href",i).html(i)}function toggleSidebar(){var e=$(window).height(),a=$(window).width(),i=420;$(".control-sidebar").hasClass("control-sidebar-open")?($(".control-sidebar, #cesiumContainer").removeClass("control-sidebar-open"),$("#open-menu").removeClass("active"),$("#cesiumContainer").height(e).width(a),$(".cesium-viewer").height(e).width(a)):($(".control-sidebar, #cesiumContainer").addClass("control-sidebar-open"),$("#open-menu").addClass("active"),$(".control-sidebar").height(e),i>a?($("#cesiumContainer, .cesium-viewer, .control-sidebar").height(e).width(a),$("#cesiumContainer, .cesium-viewer, .control-sidebar").height(e).width(a)):$("#cesiumContainer, .cesium-viewer").height(e).width(a-420))}function isEmpty(e){return!$.trim(e.html())}var homeURL=window.location.protocol+"//"+window.location.host+"/3D/",shareURL="http://climateviewer.org/3D/",proxyURL="http://climateviewer.org/3D/proxy.php?";$(window).resize(function(){resize()}),$(window).on("orientationchange",function(){resize()}),$(".panel-toggle").click(function(){var e=$(this).attr("id"),a=$("."+e),i=$(this).find("i");a.is(":visible")?($(this).removeClass("active"),a.hide(),i.removeClass("fa-chevron-down").addClass("fa-chevron-right")):($(this).addClass("active"),a.show(),i.removeClass("fa-chevron-right").addClass("fa-chevron-down"))});var imageryViewModels=[];Cesium.BingMapsApi.defaultKey="AiQDjsWpddVOFEnVY6j4Jb0S0Hoy9QMa30rvbZT1A8qd0it10NkYAgvb5sa3OeLw",imageryViewModels.push(new Cesium.ProviderViewModel({name:"Dark Matter",iconUrl:"dist/img/dark-matter.jpg",tooltip:"Map tiles by CartoDB, under CC BY 3.0. Data by OpenStreetMap, under ODbL.",creationFunction:function(){return new Cesium.UrlTemplateImageryProvider({url:"http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png",credit:"Map tiles by CartoDB, under CC BY 3.0. Data by OpenStreetMap, under ODbL."})}})),imageryViewModels.push(new Cesium.ProviderViewModel({name:"CV Blue",iconUrl:"dist/img/cv-blue.jpg",tooltip:"CartoDB World Flat Blue. Map tiles by CartoDB, under CC BY 3.0. Data by OpenStreetMap, under ODbL.",creationFunction:function(){return new Cesium.UrlTemplateImageryProvider({url:"https://cartocdn_{s}.global.ssl.fastly.net/base-flatblue/{z}/{x}/{y}.png",credit:"Map tiles by CartoDB, under CC BY 3.0. Data by OpenStreetMap, under ODbL."})}})),imageryViewModels.push(new Cesium.ProviderViewModel({name:"Watercolor",iconUrl:Cesium.buildModuleUrl("Widgets/Images/ImageryProviders/stamenWatercolor.png"),tooltip:"Reminiscent of hand drawn maps maps.stamen.com",creationFunction:function(){return new Cesium.UrlTemplateImageryProvider({url:"http://tile.stamen.com/watercolor/{z}/{x}/{y}.jpg",credit:"Map tiles by Stamen Design, under CC BY 3.0. Data by OpenStreetMap, under CC BY SA."})}})),imageryViewModels.push(new Cesium.ProviderViewModel({name:"Midnight",iconUrl:"dist/img/midnight-commander.jpg",tooltip:"CartoDB World Midnight Commander. Map tiles by CartoDB, under CC BY 3.0. Data by OpenStreetMap, under ODbL.",creationFunction:function(){return new Cesium.UrlTemplateImageryProvider({url:"https://cartocdn_{s}.global.ssl.fastly.net/base-midnight/{z}/{x}/{y}.png",credit:"Map tiles by CartoDB, under CC BY 3.0. Data by OpenStreetMap, under ODbL."})}})),imageryViewModels.push(new Cesium.ProviderViewModel({name:"Bing Aerial",iconUrl:Cesium.buildModuleUrl("Widgets/Images/ImageryProviders/bingAerialLabels.png"),tooltip:"Bing Maps aerial imagery with label overlays \nhttp://www.bing.com/maps",creationFunction:function(){return new Cesium.BingMapsImageryProvider({url:"http://dev.virtualearth.net",key:"AiQDjsWpddVOFEnVY6j4Jb0S0Hoy9QMa30rvbZT1A8qd0it10NkYAgvb5sa3OeLw",mapStyle:Cesium.BingMapsStyle.AERIAL_WITH_LABELS})}})),imageryViewModels.push(new Cesium.ProviderViewModel({name:"ESRI Aerial",iconUrl:Cesium.buildModuleUrl("Widgets/Images/ImageryProviders/esriWorldImagery.png"),tooltip:"World Imagery provides one meter or better satellite and aerial imagery in many parts of the world and lower resolution satellite imagery worldwide. www.esri.com",creationFunction:function(){return new Cesium.ArcGisMapServerImageryProvider({url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"})}})),imageryViewModels.push(new Cesium.ProviderViewModel({name:"ESRI Street",iconUrl:Cesium.buildModuleUrl("Widgets/Images/ImageryProviders/esriWorldStreetMap.png"),tooltip:"Worldwide street map presents highway-level data for the world. www.esri.com",creationFunction:function(){return new Cesium.ArcGisMapServerImageryProvider({url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer"})}})),imageryViewModels.push(new Cesium.ProviderViewModel({name:"ESRI Ocean",iconUrl:"dist/img/esri-ocean.jpg",tooltip:"Includes bathymetry, marine water body names, undersea feature names, and derived depth values in meters.",creationFunction:function(){return new Cesium.ArcGisMapServerImageryProvider({url:"http://services.arcgisonline.com/arcgis/rest/services/Ocean_Basemap/MapServer"})}})),imageryViewModels.push(new Cesium.ProviderViewModel({name:"Positron",iconUrl:"dist/img/positron.jpg",tooltip:"Map tiles by CartoDB, under CC BY 3.0. Data by OpenStreetMap, under ODbL.",creationFunction:function(){return new Cesium.UrlTemplateImageryProvider({url:"http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",credit:"Map tiles by CartoDB, under CC BY 3.0. Data by OpenStreetMap, under ODbL."})}})),imageryViewModels.push(new Cesium.ProviderViewModel({name:"Toner",iconUrl:Cesium.buildModuleUrl("Widgets/Images/ImageryProviders/stamenToner.png"),tooltip:"A high contrast black and white map.\nhttp://maps.stamen.com",creationFunction:function(){return new Cesium.UrlTemplateImageryProvider({url:"http://tile.stamen.com/toner/{z}/{x}/{y}.png",credit:"Map tiles by Stamen Design, under CC BY 3.0. Data by OpenStreetMap, under CC BY SA."})}})),imageryViewModels.push(new Cesium.ProviderViewModel({name:"ESRI NatGeo",iconUrl:Cesium.buildModuleUrl("Widgets/Images/ImageryProviders/esriNationalGeographic.png"),tooltip:"National Geographic World Map service. www.esri.com",creationFunction:function(){return new Cesium.ArcGisMapServerImageryProvider({url:"http://services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/"})}})),imageryViewModels.push(new Cesium.ProviderViewModel({name:"Bing Roads",iconUrl:Cesium.buildModuleUrl("Widgets/Images/ImageryProviders/bingRoads.png"),tooltip:"Bing Maps standard road maps\nhttp://www.bing.com/maps",creationFunction:function(){return new Cesium.BingMapsImageryProvider({url:"http://dev.virtualearth.net",key:"AiQDjsWpddVOFEnVY6j4Jb0S0Hoy9QMa30rvbZT1A8qd0it10NkYAgvb5sa3OeLw",mapStyle:Cesium.BingMapsStyle.ROAD})}}));var terrainProviders=[];terrainProviders.push(new Cesium.ProviderViewModel({name:"WGS84 Ellipsoid",iconUrl:Cesium.buildModuleUrl("Widgets/Images/TerrainProviders/Ellipsoid.png"),tooltip:"WGS84 standard ellipsoid, also known as EPSG:4326",creationFunction:function(){return new Cesium.EllipsoidTerrainProvider}})),terrainProviders.push(new Cesium.ProviderViewModel({name:"STK World Terrain meshes",iconUrl:Cesium.buildModuleUrl("Widgets/Images/TerrainProviders/STK.png"),tooltip:"High-resolution, mesh-based terrain for the entire globe. Free for use on the Internet. Closed-network options are available.\nhttp://www.agi.com",creationFunction:function(){return new Cesium.CesiumTerrainProvider({url:"//assets.agi.com/stk-terrain/world",requestWaterMask:!0,requestVertexNormals:!0})}}));var now=Cesium.JulianDate.now(),clock=new Cesium.Clock({currentTime:now}),viewer,mode,clientWidth=$(window).width(),mobile=1025;mobile>clientWidth?mode=Cesium.SceneMode.SCENE2D:(mode=Cesium.SceneMode.SCENE3D,$("#mode-2D").removeClass("active"),$("#mode-3D").addClass("active")),viewer=new Cesium.Viewer("cesiumContainer",{sceneModePicker:!1,timeline:!0,animation:!0,sceneMode:mode,navigationHelpButton:!1,navigationInstructionsInitiallyVisible:!1,imageryProvider:!1,baseLayerPicker:!1,clock:clock,terrainProvider:!1}),viewer.extend(Cesium.viewerCesiumNavigationMixin,{}),viewer.resolutionScale=1/devicePixelRatio;var baseLayerPicker=new Cesium.BaseLayerPicker("baseLayerPickerContainer",{globe:viewer.scene,imageryProviderViewModels:imageryViewModels,terrainProviderViewModels:terrainProviders}),animationContainer=$(".cesium-viewer-animationContainer"),timelineContainer=$(".cesium-viewer-timelineContainer"),credit=$(".cesium-viewer-bottom");animationContainer.hide(),timelineContainer.hide(),credit.hide(),$("#toggle-timeline").click(function(){toggleTimeline()});var startTime=Cesium.JulianDate.fromDate(new Date(Date.UTC(2012,4,8))),endTime=Cesium.JulianDate.now();viewer.timeline.zoomTo(startTime,endTime);var activeLayers={},infoBox=$(".cesium-infoBox"),layerEnabled={},me=new Self;nobjectsIn(layers,function(e){},function(e,a,i){me.addEdge(e,a,i)});var date=new Date;date.setDate(date.getDate()-1);var yesterday=Cesium.JulianDate.fromDate(date),startdate=Cesium.JulianDate.toDate(yesterday),$input=$("#datepicker").pickadate({format:"mmmm d, yyyy",formatSubmit:"yyyy-mm-dd",min:[2002,6,1],max:Cesium.JulianDate.now(),container:"#datepicker-container",closeOnSelect:!0,closeOnClear:!1,selectYears:!0,selectMonths:!0}),picker=$input.pickadate("picker");picker.set("select",startdate),picker.on({set:function(){var e=picker.get("select","yyyy-mm-dd");$(".nasa-gibs.active").each(function(){loadGIBS($(this).attr("id"),e,$(this).attr("data-format"),$(this).attr("data-zoom"))})}});var start=picker.get("select","yyyy-mm-dd"),previousTime=null,isoDate=function(e){return e.split("T")[0]},isoDateTime=clock.currentTime.toString(),time="TIME="+isoDate(isoDateTime),onClockUpdate=_.throttle(function(){isoDateTime=clock.currentTime.toString(),time=isoDate(isoDateTime),time!==previousTime&&(previousTime=time,picker.set("select",time,{format:"yyyy-mm-dd"}))},250,{leading:!0,trailing:!0});viewer.clock.onTick.addEventListener(onClockUpdate),onClockUpdate(),$("#distanceLegendDiv").before('<div class="legend-cap" title="Distance Legend"></div>').attr("title","Distance Legend"),$(".distance-legend").addClass("noselect"),$("#phone-home").on("click",function(){window.location="http://climateviewer.org/"});var defaultKMLEyeOffset=new Cesium.Cartesian3(0,5e3,0),defaultScaleByDistance=new Cesium.NearFarScalar(1,.5,1,.3),defaultTranslucency=new Cesium.NearFarScalar(150,1,3e6,0);$("#mode-3D").click(function(){viewer.scene.morphTo3D(),$("#mode-2D.active").removeClass("active"),$(this).addClass("active")}),$("#mode-2D").click(function(){viewer.scene.morphTo2D(),$("#mode-3D.active").removeClass("active"),$(this).addClass("active")}),$(".cesium-baseLayerPicker-item").each(function(){var e=$(this).find($(".cesium-baseLayerPicker-itemLabel")),a=encodeURIComponent(e.html());$(this).prop("id",a)});var initialLayers=(getURLParameter("layersOn")||"").split(","),disabledLayers=(getURLParameter("layersOff")||"").split(",");""===initialLayers[0]&&(initialLayers=[]),""===disabledLayers[0]&&(disabledLayers=[]);var allLayers=initialLayers.concat(disabledLayers),baseLayer=getURLParameter("baseLayer")||"";if(baseLayer.length>0){console.log("yes + "+baseLayer);var baseLayerId=encodeURIComponent(baseLayer);console.log(baseLayerId),$("div[id='"+baseLayerId+"']").trigger("click")}if(allLayers.length>0){var latView=getURLParameter("lat")||"-78.176832746519",lonView=getURLParameter("lon")||"31.300283760032368",zoomView=getURLParameter("zoom")||"26596280.257583864",dateView=getURLParameter("date")||time;if(dateView!==time&&picker.set("select",dateView,{format:"yyyy-mm-dd"}),"-78.176832746519"!==latView){var includeOnly=!0;initLayers(includeOnly),viewer.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(latView,lonView,zoomView)})}else initLayers();var modeView=getURLParameter("mode")||"2D";"2D"!==modeView&&(console.log(".mode-"+modeView),$("#mode-"+modeView).click());var shared=$('<div class="folder" style="display: block;"></div>').prependTo("#map-layers");$('<h2 class="toggle active">Shared Layers</h2>').prependTo("#map-layers").show();for(var i=0;i<allLayers.length;i++)$("#"+allLayers[i]).detach().appendTo(shared).show();for(var i=0;i<initialLayers.length;i++)$("."+initialLayers[i]+"-load").click()}else initLayers();$("#share-active-layers").click(function(){shareLink()}),$(".report-tab").click(function(e){e.preventDefault();var a=$(window).width(),i=$(window).height();return 1024>a?(window.open("https://climateviewer.crowdmap.com/","","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height="+i+",width="+a),!1):(window.open("https://climateviewer.crowdmap.com/","","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=800,width=1024"),!1)}),$("#open-menu").click(function(){toggleSidebar()}),$("#options-menu").click(function(){var e=$("div.map-options");e.is(":visible")?(console.log("hide it"),e.removeClass("show"),$(this).removeClass("active")):(console.log("show it"),e.addClass("show"),$(this).addClass("active"))}),$("#clear-layers").click(function(){$("i.active").trigger("click")}),$("#sun-control").toggle(function(e){e.preventDefault(),viewer.scene.globe.enableLighting=!0,$(this).addClass("active")},function(e){e.preventDefault(),viewer.scene.globe.enableLighting=!1,$(this).removeClass("active")}),$("#close-menu").click(function(){toggleSidebar()}),$("#collapse-menu").click(function(){$(".fa-folder-open-o.active").trigger("click"),$(".folder h2.active").trigger("click"),$("h2.active").trigger("click")}),$("#top-layers").click(function(){$(".map-layers-window").animate({scrollTop:$("#top").offset().top-90},500)}),$(".cesium-baseLayerPicker-dropDown").addClass("cesium-baseLayerPicker-dropDown-visible").detach().appendTo($("#base")),$(".cesium-viewer-geocoderContainer").detach().prependTo($(".search")),$(".cesium-geocoder-input").addClass("cesium-geocoder-input-wide"),$("#active-layers-toggle").toggle(function(){$(".lbw.active").each(function(){var e=$(this).prop("id");$('<span id="'+e+'-holder" style="display: none;" />').insertAfter($(this)),$(this).detach().appendTo("#active-layers")}),$(this).html('<i class="fa fa-2x fa-eye-slash"></i> All'),isEmpty($("#active-layers"))&&$("#active-layers").html('<div class="cv-learn"><h3><i style="color:#F00" class="fa fa-fw fa-exclamation-triangle"></i> NO ACTIVE LAYERS SELECTED</h3><p style="text-align:left;">Try turning on a map layer by clicking the <i class="fa fa-fw fa-play"></i> icon.</p></div>'),$(".active-layers-label").show(),$("#active-layers").show(),$(".all-layers-label").hide(),$("#map-layers").hide()},function(){$("#active-layers .lbw.active").each(function(){var e=$(this).prop("id");$(this).detach().insertBefore($("#"+e+"-holder")),$("#"+e+"-holder").remove()}),$("#active-layers").html(""),
$(this).html('<i class="fa fa-2x fa-eye"></i> Active'),$(".active-layers-label").hide(),$("#active-layers").hide(),$(".all-layers-label").show(),$("#map-layers").show()}),$("#about").featherlight($("#about-modal"),{afterOpen:function(){$(".featherlight .panel-content.instructions").is(":visible")||$(".featherlight #instructions").trigger("click")},afterClose:function(){$("#about-modal iframe").remove(),$(".youtube").show()}}),$.featherlight($("#about-modal"),{afterClose:function(){$("#about-modal iframe").remove(),$("#about-modal p.intro").remove(),$(".youtube").show()}}),$(".youtube").each(function(){var e=$(this).data("id");$(this).css("background-image","url(http://i.ytimg.com/vi/"+e+"/sddefault.jpg)"),$(this).append($("<div/>",{"class":"play"})),$(this).click(function(){var a="https://www.youtube.com/embed/"+e+"?autoplay=1&autohide=1";$(this).data("params")&&(a+="&"+$(this).data("params"));var i=$("<iframe/>",{frameborder:"0",src:a});$(this).hide(),i.insertAfter($(this))})}),$(".logo").appendTo($("#cesiumContainer")),$("style").remove(),$("#cesiumContainer, #open-menu, .map-options").show(),resize();