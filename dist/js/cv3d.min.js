"use strict";function resize(){var e=$(window).height(),a=$(window).width(),i=767;$(".control-sidebar").height(e-50),$(".main-sidebar").height(e-100),$(".tab-content").height(e-100),$("html").height(e),$("body").height(e),$(".content-wrapper").height(e-50),$("#cesiumContainer").height(e-50).width(a),$(".cesium-viewer").height(e-50).width(a),i>a&&($("#siderbar-toggle i").removeClass("fa-chevron-left").addClass("fa-chevron-right"),$(".control-sidebar").removeClass("control-sidebar-open"))}function getURLParameter(e){for(var a=decodeURIComponent(window.location.search.substring(1)),i=a.split("&"),r=0;r<i.length;r++){var t=i[r].split("=");if(t[0]==e)return t[1]}}function loading(e){$("."+e+"-load").removeClass("fa-play").addClass("fa-spinner fa-spin loading active")}function loaded(e){$("."+e+"-load").removeClass("fa-spinner fa-spin loading").addClass("fa-check")}function loadError(e,a,i){var r=$("#"+e);$('<div class="details"><div class="header"><i class="fa fa-fw fa-exclamation-circle"></i> Load Failed</div>Please use <a href="mailto:jim@climateviewer.com?subject=Climate Viewer 3D broken link - '+e+"&amp;body=Unfortunately this ( "+a+" ) URL is not working properly due to ( "+i+' ), please look into it.  Sent from http://climateviewer.com/3D/" target="_self">this link</a> to report this error.<br><div class="darkwell"><strong>ERROR:</strong> '+i+"</div></div>").appendTo(r);var t=$("."+e+"-load"),s=$("#"+e+" span");t.removeClass("fa-spinner fa-spin active loading").addClass("fa-exclamation-triangle fail"),s.removeClass("active").addClass("fail")}function NSlider(e){var a=e.src,i=e.mod;e=e||{},e.element||(e.element=$('<div class="item slider"></div>')),e.min||(e.min=0),e.max||(e.max=1),e.start||(e.start=1),e.label||(e.label=""),$('<div class="label">'+e.label+"</div>").appendTo(e.element);var r=$('<input class="'+e.label+'" type="range">').appendTo(e.element),t=e.start/e.max*100;return r.attr("min",0),r.attr("max",100),r.attr("step",1),r.attr("value",t),r.on("change",function(){var t=r.val(),s=(t/100).toFixed(2),l=e.max*s;if(i)for(var o=a.entities.values,n=0;n<o.length;n++){var d=o[n],c=d.billboard.color;"alpha"==i&&(d.billboard.color=new Cesium.Color.fromAlpha(c,l))}else"opacity"==e.label&&(a.alpha=l),"contrast"==e.label&&(a.contrast=l),"saturation"==e.label&&(a.saturation=l),"brightness"==e.label&&(a.brightness=l),"gamma"==e.label&&(a.gamma=l)}),e.element}function loadSliders(e,a){var i=$("#"+a+" .lb"),r=$('<div class="details '+a+'-sliders layer-sliders" />').insertAfter(i),t=$('<div class="slider-content" />').appendTo(r),s=$('<div class="ui divided list" />').appendTo(t);NSlider({label:"opacity",src:e}).appendTo(s),NSlider({max:2,label:"brightness",src:e}).appendTo(s),NSlider({max:2,label:"contrast",src:e}).appendTo(s),NSlider({max:2,label:"saturation",src:e}).appendTo(s),e.alpha=1,e.brightness=1,e.contrast=1,e.saturation=1,loaded(a)}function loadGIBS(e,a){removeImagery(e);var i=viewer.imageryLayers.addImageryProvider(new Cesium.WebMapTileServiceImageryProvider({url:"//map1.vis.earthdata.nasa.gov/wmts-webmerc/wmts.cgi?TIME="+a,layer:e,style:"",format:"image/jpeg",tileMatrixSetID:"GoogleMapsCompatible_Level9",maximumLevel:9,tileWidth:256,tileHeight:256,tilingScheme:new Cesium.WebMercatorTilingScheme}));activeLayers[e]=i,$("."+e+"-sliders").remove(),loadSliders(i,e)}function loadWmts(e,a,i){var r=viewer.imageryLayers.addImageryProvider(new Cesium.WebMapTileServiceImageryProvider({url:a,layers:i,style:"",format:"image/png",tileMatrixSetID:"GoogleMapsCompatible_Level9",maximumLevel:9,tileWidth:256,tileHeight:256,tilingScheme:new Cesium.WebMercatorTilingScheme}));activeLayers[e]=r,loadSliders(r,e)}function loadWms(e,a,i,r){var t;t=r?viewer.imageryLayers.addImageryProvider(new Cesium.WebMapServiceImageryProvider({url:a,layers:i,sourceUri:a,enablePickFeatures:!1,parameters:{transparent:!0,format:"image/png"}})):viewer.imageryLayers.addImageryProvider(new Cesium.WebMapServiceImageryProvider({url:a,layers:i,sourceUri:a,parameters:{transparent:!0,format:"image/png"}})),activeLayers[e]=t,loadSliders(t,e)}function loadOsmLayer(e,a){var i=viewer.imageryLayers.addImageryProvider(new Cesium.createOpenStreetMapImageryProvider({url:a}));activeLayers[e]=i,loadSliders(i,e)}function loadCartoDB(e,a){var i=viewer.imageryLayers.addImageryProvider(new Cesium.UrlTemplateImageryProvider({url:a}));activeLayers[e]=i,loadSliders(i,e)}function loadBingLayer(e,a){var i,r="//dev.virtualearth.net",t="AiQDjsWpddVOFEnVY6j4Jb0S0Hoy9QMa30rvbZT1A8qd0it10NkYAgvb5sa3OeLw";i="AERIAL"==a?viewer.imageryLayers.addImageryProvider(new Cesium.BingMapsImageryProvider({url:r,key:t,mapStyle:Cesium.BingMapsStyle.AERIAL})):"AERIAL_WITH_LABELS"==a?viewer.imageryLayers.addImageryProvider(new Cesium.BingMapsImageryProvider({url:r,key:t,mapStyle:Cesium.BingMapsStyle.AERIAL_WITH_LABELS})):viewer.imageryLayers.addImageryProvider(new Cesium.BingMapsImageryProvider({url:r,key:t,mapStyle:Cesium.BingMapsStyle.ROADS})),activeLayers[e]=i,loadSliders(i,e)}function newMarkerLabel(e,a){var i=new Cesium.LabelGraphics;return"usgs-eq"==a?i.text="M"+e.properties.mag:e.label.text?i.text=e.label.text:i.text="",i.horizontalOrigin=Cesium.HorizontalOrigin.CENTER,i.verticalOrigin=Cesium.VerticalOrigin.BOTTOM,i.outlineWidth=5,i.style=Cesium.LabelStyle.FILL_AND_OUTLINE,i.translucencyByDistance=defaultTranslucency,i.eyeOffset=defaultKMLEyeOffset,i}function modMarkers(e,a,i,r,t,s){if(s===!1)var l=$("."+e+"-details"),o=$('<div class="details '+e+'-list marker-list" />').insertAfter(l),n=[];for(var d=a.entities.values,c=0;c<d.length;c++){var v=d[c];console.log(v);var m,f=new Cesium.BillboardGraphics;m=i?i:v.billboard.image?v.billboard.image:"/img/icons/cv3d.png",f.image=m;var u;u="usgs-eq"==t?v.properties.mag:r?r:3;var p,h;if(p=v.properties.title?"<h3>"+v.properties.title+"</h3>":v.properties.Name?"<h3>"+v.properties.Name+"</h3>":v.properties.name?"<h3>"+v.properties.name+"</h3>":v.properties.LICENSEE?"<h3>"+v.properties.LICENSEE+"</h3>":"",h=v.properties.mag?"<div>Place: "+v.properties.place+"<br>Magnitude: "+v.properties.mag+'<br><a href="'+v.properties.url+'" target="_blank">Click here for more info.</a></div>':v.properties.Description?"<div>"+v.properties.Description+"</div>":v.properties.description?"<div>"+v.properties.description+"</div>":v.properties.desc?"<div>"+v.properties.desc+"</div>":v.properties.FREQUENCY?"<div>FREQUENCY: "+v.properties.FREQUENCY+"<br>CALLSIGN: "+v.properties.CALLSIGN+"<br>SERVICE: "+v.properties.SERVICE+"<br></div>":"",v.title=p,v.description=h,f.scale=u,f.width=32,f.height=32,f.alignedAxis=Cesium.Cartesian3.ZERO,f.scaleByDistance=defaultScaleByDistance,v.billboard=f,s===!1){var g=v.position.getValue(),y=Cesium.Ellipsoid.WGS84.cartesianToCartographic(g),w=Cesium.Math.toDegrees(y.longitude),b=Cesium.Math.toDegrees(y.latitude);n.push('<li data-lon="'+w+'"  data-lat="'+b+'">'+v.title+"</li>")}t&&(v.label=newMarkerLabel(v,t))}s===!1&&($('<h5><i class="fa fa-fw fa-map-marker"></i> Map Markers</h5>').appendTo(o),$("<ol/>",{"class":"markers",html:n.join("")}).appendTo(o),$(".markers li").click(function(){var e=$(this).attr("data-lon"),a=$(this).attr("data-lat");viewer.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(e,a,3e3)})}))}function loadArcGisLayer(e,a,i,r,t,s){var l;l=r?t?viewer.imageryLayers.addImageryProvider(new Cesium.ArcGisMapServerImageryProvider({url:a,enablePickFeatures:!1,tileWidth:t,tileHeight:s,layers:i})):viewer.imageryLayers.addImageryProvider(new Cesium.ArcGisMapServerImageryProvider({url:a,enablePickFeatures:!1,layers:i})):t?viewer.imageryLayers.addImageryProvider(new Cesium.ArcGisMapServerImageryProvider({url:a,enablePickFeatures:!0,tileWidth:t,tileHeight:s,layers:i})):viewer.imageryLayers.addImageryProvider(new Cesium.ArcGisMapServerImageryProvider({url:a,enablePickFeatures:!0,layers:i})),activeLayers[e]=l,loadSliders(l,e),loaded(e)}function loadGeoJson(e,a,i,r,t,s,l){new Cesium.GeoJsonDataSource.load(a).then(function(a){modMarkers(e,a,t,r,i,l),viewer.dataSources.add(a),activeLayers[e]=a,s&&(s===!0?viewer.flyTo(a):$(".cesium-home-button").trigger("click")),loaded(e)},function(i){loadError(e,a,i)})}function loadKml(e,a,i,r,t,s,l,o){i?new Cesium.KmlDataSource.load(a,{proxy:{getURL:function(e){return proxyURL+encodeURIComponent(e)}},sourceUri:a}).then(function(a){o&&modMarkers(a,t,s,l),viewer.dataSources.add(a),activeLayers[e]=a,r&&(r===!0?viewer.flyTo(a):$(".cesium-home-button").trigger("click")),loaded(e)},function(i){loadError(e,a,i)}):new Cesium.KmlDataSource.load(a).then(function(a){o&&modMarkers(a,t,s,l),viewer.dataSources.add(a),activeLayers[e]=a,r&&(r===!0?viewer.flyTo(a):$(".cesium-home-button").trigger("click")),loaded(e)},function(i){loadError(e,a,i)})}function removeImagery(e){var a=activeLayers[e];delete activeLayers[e],viewer.imageryLayers.remove(a,!1)}function disableLayer(e){var a=e.I,i=e.T;if(void 0!==layerEnabled[e.I]){if("nasa-gibs"===i||"cartodb-layer"===i||"wmts"===i||"wms"===i||"base-layer"===i||"arcgis"===i||"arcgis-base-layer"===i||"arcgis-layer"===i||"bing"===i)removeImagery(a),$("."+a+"-sliders").remove();else{var r=activeLayers[a];delete activeLayers[a],viewer.dataSources.remove(r)}("geojson"===i||"kml"===i)&&($("."+a+"-tree").removeClass("active"),$("."+a+"-list").remove()),delete layerEnabled[a]}}function updateLayer(e,a){loading(e);var i=me.node(e);i||console.error("missing layer",e);var r=i.G,t=i.L,s=i.HT,l=i.W,o=i.M,n=i.MI,d=i.MS,c=i.ML,v=i.C,f=i.Y,m=i.P,u=i.X,p=picker.get("select","yyyy-mm-dd");if(!a)var h=i.Z;f=f?!0:!1,void 0===layerEnabled[e]&&(layerEnabled[e]=!1,"wms"===i.T?loadWms(e,r,t,u):"nasa-gibs"===i.T?loadGIBS(e,p):"wtms"===i.T?loadWmts(e,r,t):"cartodb-layer"===i.T?loadCartoDB(e,r):"base-layer"===i.T?loadOsmLayer(e,r):"arcgis"===i.T||"arcgis-layer"===i.T||"arcgis-base-layer"===i.T?loadArcGisLayer(e,r,t,u,l,s):"geojson"===i.T?loadGeoJson(e,r,c,d,n,h,f):"kml"===i.T?loadKml(e,r,m,h,n,d,c,o):"bing"===i.T?loadBingLayer(e,r):console.log(e+" failed to load map type: "+i.T),v&&toggleTimeline(!0))}function newFolderLabel(e,a,i){if(i)var r='<i class="fa fa-fw '+i+'"></i>';else r="";var t=$("<h2>").addClass("toggle").html(r+e.N).click(function(){a.is(":visible")?(a.hide(),t.removeClass("active")):(a.show(),t.addClass("active"))});return t}function initDetails(e,a,i,r,t,s){var l=$('<div class="details '+e+'-content" />').appendTo(i);$('<div class="header"><i class="fa fa-fw fa-info-circle"></i> Layer Details</div><span>'+r+' &bull; <a href="'+t+'" target="_blank" rel="nofollow">More Info</a></span>').appendTo(l),"kml"==a&&$('<div class="header"><i class="fa fa-fw fa-download"></i> Data Source</div><span>Keyhole Markup Language (KML) &bull; <a href="'+s+'">Download</a></span>').appendTo(l),"geojson"==a&&$('<div class="header"><i class="fa fa-fw fa-download"></i> Data Source</div><span>GeoJSON &bull; <a href="'+s+'">Download</a></span>').appendTo(l),"nasa-gibs"==a&&$('<div class="header"><i class="fa fa-fw fa-file-o"></i> Data Source</div><span>Web Map Tile Service (WMTS)</span>').appendTo(l),"wms"==a&&$('<div class="header"><i class="fa fa-fw fa-file-o"></i> Data Source</div><span>Web Mapping Service (WMS)<br><a target="_blank" rel="nofollow" href="'+s+'?request=GetCapabilities&service=WMS">Get Capabilities</a></span>').appendTo(l),"base-layer"==a&&$('<div class="header"><i class="fa fa-fw fa-file-o"></i> Data Source</div><span>OpenStreetMap (OSM) Base Map</span>').appendTo(l),("arcgis"==a||"arcgis-layer"==a)&&$('<div class="header"><i class="fa fa-fw fa-file-o"></i> Data Source</div><span>ArcGIS MapServer<br><a target="_blank" rel="nofollow" href="'+s+'/legend">Map Legend</a> &bull; <a target="_blank" rel="nofollow" href="'+s+'">MapServer Information</a></span>>').appendTo(l),$('<div class="header"><i class="fa fa-share-square-o fa-fw"></i> Share This Layer</div><span>Use this url to share this layer: <a href="'+homeURL+"index.html?layersOn="+e+'" target="_self">Share Link</a><span><div class="header"><i class="fa fa-exclamation-triangle fa-fw"></i> Report Error</div><span>If you are experiencing problems loading this layer, or you would like to suggest corrections, comments, or concerns, please email me using this link: <a href="mailto:jim@climateviewer.com?subject=Climate Viewer broken link - '+e+"&amp;body=Unfortunately this ( "+s+' ) URL is not working properly, please look into it. Sent from http://climateviewer.com/3D/" target="_self">Report Error</a></span>').appendTo(l)}function addTree(e,a,i){var r=me.successors(e);return _.each(r,function(e){var t,r=me.node(e),s=r.I,l=r.T,o=$('<div class="folder" />').html(r);if(r.T){var d=!0;if(d){var g,y,w,b,C,L,T,c=r.G,v=r.S,f=r.U,m=r.H,u=r.NL,p=r.C,h=r.Y;h!==!0&&(h=!1),console.log(h),t=$("<div>").data("l",r).attr("id",r.I).addClass("lbw").addClass(r.T),g=$("<div>").addClass("lb").appendTo(t),b=$("<i>").addClass("fa fa-fw fa-folder-o").toggle(function(){0==y.children().length&&initDetails(s,l,y,v,f,c),y.show(),y.focus(),b.removeClass("fa-folder-o").addClass("fa-folder-open-o active")},function(){y.hide(),b.removeClass("fa-folder-open-o active").addClass("fa-folder-o")}).appendTo(g),"geojson"===r.T&&h===!1&&(C=$('<i title="Expand Marker Tree" class="fa fa-fw fa-sitemap toggle-list '+s+'-tree"></i>'),C.click(function(){setTimeout(function(){$("."+s+"-list").is(":visible")?($("."+s+"-list").hide(),C.removeClass("active")):($("."+s+"-list").show(),C.addClass("active"))})}).appendTo(g)),("nasa-gibs"===r.T||"cartodb-layer"===r.T||"wmts"===r.T||"wms"===r.T||"base-layer"===r.T||"arcgis"===r.T||"arcgis-layer"===r.T||"bing"===r.T)&&(L=$('<i title="Expand Marker Tree" class="fa fa-fw fa-sliders toggle-list '+s+'-tree"></i>'),L.click(function(){setTimeout(function(){$("."+s+"-sliders").is(":visible")?($("."+s+"-sliders").hide(),L.removeClass("show-sliders")):($("."+s+"-sliders").show(),L.addClass("show-sliders"))})}).appendTo(g)),w=$('<i class="fa fa-fw fa-play '+s+'-load"></i>'),m&&w.addClass("large-layer"),u&&w.addClass("new-layer"),w.toggle(function(){setTimeout(function(){w.hasClass("fa-play")&&(i?updateLayer(s,i):updateLayer(s),y.is(":visible")&&$("."+r.I+"-picker").show(),T.hasClass("active")||T.addClass("active"),t.hasClass("active")||t.addClass("active"),p&&toggleTimeline(!0),"geojson"===r.T&&h===!1&&C.show(),("nasa-gibs"===r.T||"cartodb-layer"===r.T||"wmts"===r.T||"wms"===r.T||"base-layer"===r.T||"arcgis"===r.T||"arcgis-layer"===r.T||"bing"===r.T)&&L.show())})},function(){setTimeout(function(){w.hasClass("fa-check")&&(disableLayer(r),w.removeClass("fa-check active").addClass("fa-play"),T.hasClass("active")&&T.removeClass("active"),t.hasClass("active")&&t.removeClass("active"),b.hasClass("fa-folder-open-o")&&b.trigger("click"),"geojson"===r.T&&h===!1&&C.hide(),("nasa-gibs"===r.T||"cartodb-layer"===r.T||"wmts"===r.T||"wms"===r.T||"base-layer"===r.T||"arcgis"===r.T||"arcgis-layer"===r.T||"bing"===r.T)&&(L.hide(),L.removeClass("show-sliders")))})}).appendTo(g),T=$("<span>").html(r.N).addClass("label"),T.toggle(function(){T.hasClass("fail")||(T.hasClass("active")||T.addClass("active"),w.trigger("click"))},function(){T.hasClass("fail")||(T.hasClass("active")&&T.removeClass("active"),w.trigger("click"))}).appendTo(g),y=$('<div class="ui card '+s+'-details layer-details" />').appendTo(t),y.hide()}}else{var n=r.icon;t=newFolderLabel(r,o,n)}if(null!=t){a.append(t);var k=addTree(r.I,o,i);k.length&&a.append(o)}}),r}function initLayers(e){var a=$("#map-layers");a.addClass("ui"),e?_.each(me.sources(),function(i){addTree(i,a,e)}):_.each(me.sources(),function(e){addTree(e,a)})}function toggleTimeline(e){if(e)animationContainer.show(),timelineContainer.show(),$(".toggle-timeline").addClass("active");else if(animationContainer.is(":visible"))animationContainer.hide(),timelineContainer.hide(),$(".toggle-timeline").removeClass("active");else{animationContainer.show(),timelineContainer.show();var a=Cesium.JulianDate.fromDate(new Date(Date.UTC(2012,4,8))),i=Cesium.JulianDate.now();viewer.timeline.zoomTo(a,i),$(".toggle-timeline").addClass("active")}}function shareLink(){function r(){$("#includeView").prop("disabled",!0).parent().prop("title","Not available in 2D or Flat Earth mode yet.")}function w(e){var a=e,i="r3zn8d",r="b5c2d6d1704074b0741a7449a98e3fcef2790699";$.ajax({url:"https://api-ssl.bitly.com/v3/shorten",data:{longUrl:a,access_token:r,login:i},dataType:"jsonp",success:function(e){var a=e.data.url;$("#result").html('<a href="'+a+'" target="_self">'+a+"</a>")}})}var e="",a="",i=shareURL;if($(".geojson.active, .kml.active, .arcgis.active, .wms.active, .wtms.active, .nasa-gibs.active").each(function(){var a=$(this);if(a.hasClass("active")){var i=a.attr("id");e+=i+","}}),$(".cartodb-layer.active, .bing.active, .arcgis-base-layer.active, .base-layer.active").each(function(){var e=$(this);if(e.hasClass("active")){var i=e.attr("id");a+=i+","}}),i+="index.html?",e.length>0&&(e=e.substring(0,e.length-1),i+="layersOn="+e),a.length>0&&(a=a.substring(0,a.length-1),i+="&baseLayers="+a),$(".mode-2D").hasClass("active"))i+="&mode=2D",r();else if($(".mode-flat").hasClass("active"))i+="&mode=flat",r();else if($("#includeView").hasClass("active")){$("#includeView").prop("disabled",!1).parent().prop("title","");var t=viewer.scene,s=t.camera,l=new Cesium.Cartesian2(viewer.container.clientWidth/2,viewer.container.clientHeight/2),o=viewer.scene.camera.getPickRay(l),n=viewer.scene.globe.pick(o,viewer.scene),d=viewer.scene.globe.ellipsoid.cartesianToCartographic(n),c=s.positionCartographic.height,v=d.longitude*(180/Math.PI),f=d.latitude*(180/Math.PI),m=v.toFixed(5),u=f.toFixed(5),p=c.toFixed(2);i+="&lat="+m,i+="&lon="+u,i+="&zoom="+p,i+="&mode=3D"}var h=picker.get("select","yyyy-mm-dd");i+="&date="+h;var g=$(".share-all-layers");g.attr("href",i).html(i);encodeURIComponent(i);w(i)}function openPicker(){$("#datepicker").pickadate("picker").open(),console.log("clicked")}var homeURL=window.location.protocol+"//"+window.location.host+"/3D/",shareURL="http://climateviewer.org/3D/",proxyURL="/proxy.php?";$(window).resize(function(){resize()});var imageryViewModels=[];Cesium.BingMapsApi.defaultKey="AiQDjsWpddVOFEnVY6j4Jb0S0Hoy9QMa30rvbZT1A8qd0it10NkYAgvb5sa3OeLw";var terrainProviders=[];terrainProviders.push(new Cesium.ProviderViewModel({name:"WGS84 Ellipsoid",iconUrl:Cesium.buildModuleUrl("Widgets/Images/TerrainProviders/Ellipsoid.png"),tooltip:"WGS84 standard ellipsoid, also known as EPSG:4326",creationFunction:function(){return new Cesium.EllipsoidTerrainProvider}})),terrainProviders.push(new Cesium.ProviderViewModel({name:"STK World Terrain meshes",iconUrl:Cesium.buildModuleUrl("Widgets/Images/TerrainProviders/STK.png"),tooltip:"High-resolution, mesh-based terrain for the entire globe. Free for use on the Internet. Closed-network options are available.\nhttp://www.agi.com",creationFunction:function(){return new Cesium.CesiumTerrainProvider({url:"//assets.agi.com/stk-terrain/world",requestWaterMask:!0,requestVertexNormals:!0})}}));var now=Cesium.JulianDate.now(),clock=new Cesium.Clock({currentTime:now}),viewer;viewer=$("body").hasClass("mobile")?new Cesium.Viewer("cesiumContainer",{sceneModePicker:!1,timeline:!0,animation:!0,sceneMode:Cesium.SceneMode.SCENE3D,navigationHelpButton:!0,navigationInstructionsInitiallyVisible:!1,imageryProvider:!1,baseLayerPicker:!1,clock:clock,terrainProvider:!1,skyAtmosphere:!1,skyBox:!1,targetFrameRate:15}):new Cesium.Viewer("cesiumContainer",{sceneModePicker:!1,timeline:!0,animation:!0,sceneMode:Cesium.SceneMode.SCENE3D,navigationHelpButton:!0,navigationInstructionsInitiallyVisible:!0,imageryProvider:!1,baseLayerPicker:!1,clock:clock,terrainProvider:!1,targetFrameRate:60}),viewer.resolutionScale=1/devicePixelRatio,viewer.scene.imageryLayers.removeAll(),viewer.scene.globe.baseColor=Cesium.Color.BLACK;var baseLayerPicker=new Cesium.BaseLayerPicker("baseLayerPickerContainer",{globe:viewer.scene,imageryProviderViewModels:imageryViewModels,terrainProviderViewModels:terrainProviders}),activeLayers={},infoBox=$(".cesium-infoBox"),layerEnabled={},me=Self();nobjectsIn(layers,function(e){},function(e,a,i){me.addEdge(e,a,i)});var date=new Date;date.setDate(date.getDate()-1);var yesterday=Cesium.JulianDate.fromDate(date),time=Cesium.JulianDate.toDate(yesterday),$input=$("#datepicker").pickadate({format:"mmmm d, yyyy",formatSubmit:"yyyy-mm-dd",min:[2012,4,8],max:Cesium.JulianDate.now(),container:"#datepicker-container",closeOnSelect:!0,closeOnClear:!1,selectYears:!0,selectMonths:!0}),picker=$input.pickadate("picker");picker.set("select",time),picker.on({set:function(){var e=picker.get("select","yyyy-mm-dd");console.log(e),$(".nasa-gibs.active").each(function(){loadGIBS($(this).attr("id"),e)})}});var start=picker.get("select","yyyy-mm-dd"),previousTime=null,isoDate=function(e){return e.split("T")[0]},isoDateTime=clock.currentTime.toString(),time="TIME="+isoDate(isoDateTime),onClockUpdate=_.throttle(function(){var e=clock.currentTime.toString(),a=isoDate(e);a!==previousTime&&(previousTime=a,picker.set("select",a,{format:"yyyy-mm-dd"}))},250,{leading:!0,trailing:!0});viewer.clock.onTick.addEventListener(onClockUpdate),onClockUpdate();var defaultKMLEyeOffset=new Cesium.Cartesian3(0,5e3,0),defaultScaleByDistance=new Cesium.NearFarScalar(1,.5,1,.3),defaultTranslucency=new Cesium.NearFarScalar(150,1,3e6,0),animationContainer=$(".cesium-viewer-animationContainer"),timelineContainer=$(".cesium-viewer-timelineContainer"),credit=$(".cesium-viewer-bottom");animationContainer.hide(),timelineContainer.hide(),credit.hide(),$(".toggle-timeline").click(function(e){e.preventDefault(),toggleTimeline()});var startTime=Cesium.JulianDate.fromDate(new Date(Date.UTC(2012,4,8))),endTime=Cesium.JulianDate.now();viewer.timeline.zoomTo(startTime,endTime),$(".mode-3D").click(function(){viewer.scene.morphTo3D(),$(".map-mode div.active").removeClass("active"),$(this).addClass("active")}),$(".mode-2D").click(function(){viewer.scene.morphTo2D(),$(".map-mode div.active").removeClass("active"),$(this).addClass("active")}),$(".mode-flat").click(function(){viewer.scene.morphToColumbusView(),$(".map-mode div.active").removeClass("active"),$(this).addClass("active")});var initialLayers=(getURLParameter("layersOn")||"").split(","),initialBaseLayers=(getURLParameter("baseLayers")||"").split(","),disabledLayers=(getURLParameter("layersOff")||"").split(",");""===initialLayers[0]&&(initialLayers=[]),""===disabledLayers[0]&&(disabledLayers=[]);var allLayers=initialLayers.concat(disabledLayers),baseLayers=initialBaseLayers.concat();if(allLayers.length>0){var latView=getURLParameter("lat")||"-78.176832746519",lonView=getURLParameter("lon")||"31.300283760032368",zoomView=getURLParameter("zoom")||"26596280.257583864",dateView=getURLParameter("date")||time,modeView=getURLParameter("mode")||"3D";if(dateView!==time&&picker.set("select",dateView,{format:"yyyy-mm-dd"}),modeView&&(console.log(".mode-"+modeView),$(".mode-"+modeView).click()),"-78.176832746519"!==latView){var includeOnly=!0;initLayers(includeOnly),viewer.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(latView,lonView,zoomView)})}else initLayers();var shared=$('<div class="folder" style="display: block;"></div>').prependTo("#map-layers");if($('<h2 class="toggle active">Shared Layers</h2>').prependTo("#map-layers").show(),baseLayers.length>0)for(var i=0;i<baseLayers.length;i++)$("."+initialBaseLayers[i]+"-load").click();for(var i=0;i<allLayers.length;i++)$("#"+allLayers[i]).detach().appendTo(shared).show();for(var i=0;i<initialLayers.length;i++)$("."+initialLayers[i]+"-load").click()}else initLayers();$(".share-active-layers").click(function(e){e.preventDefault(),shareLink(),$("#shareModal").modal()}),$(".report-tab").click(function(e){e.preventDefault();var a=$(window).width(),i=$(window).height();return 1024>a?(window.open("https://climateviewer.crowdmap.com/","","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height="+i+",width="+a),!1):(window.open("https://climateviewer.crowdmap.com/","","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=800,width=1024"),!1)}),$(".clear-layers").click(function(e){e.preventDefault(),$("i.active").trigger("click"),$(".Bing_AERIAL_WITH_LABELS-load").click()}),$(".collapse-menu").click(function(e){e.preventDefault(),$(".fa-folder-open-o.active").trigger("click"),$(".folder h2.active").trigger("click"),$("h2.active").trigger("click")}),$(".top-layers").click(function(e){e.preventDefault(),$(".tab-content").animate({scrollTop:$("#top").offset().top-90},500)}),$(".sun-control").toggle(function(e){e.preventDefault(),viewer.scene.globe.enableLighting=!0,$(this).addClass("active")},function(e){e.preventDefault(),viewer.scene.globe.enableLighting=!1,$(this).removeClass("active")}),$(".about-jim").click(function(e){e.preventDefault(),window.location="https://climateviewer.com/rezn8d/"}),$(".reset-view").click(function(e){e.preventDefault(),$(".cesium-home-button").trigger("click")}),$(".date-icon").click(function(e){e.preventDefault(),e.stopPropagation(),openPicker()}),$(".cesium-baseLayerPicker-dropDown").addClass("cesium-baseLayerPicker-dropDown-visible").detach().appendTo($("#base")),$(".cesium-viewer-geocoderContainer").detach().prependTo($(".search")),$(".cesium-geocoder-input").addClass("cesium-geocoder-input-wide"),$(document).ready(function(){function a(){$(".panel-heading a i.fa-chevron-down").removeClass("fa-chevron-down").addClass("fa-chevron-right")}if($(".youtube").each(function(){$(this).css("background-image","url(http://i.ytimg.com/vi/"+this.id+"/sddefault.jpg)"),$(this).append($("<div/>",{"class":"play"})),$(document).delegate("#"+this.id,"click",function(){var e="https://www.youtube.com/embed/"+this.id+"?autoplay=1&autohide=1";$(this).data("params")&&(e+="&"+$(this).data("params"));var a=$("<iframe/>",{frameborder:"0",src:e,width:$(this).width(),height:$(this).height()});$(this).hide(),$("#tutorial").append(a)})}),$(".resources-intro")){var e=$(window).height();$(".resources-intro").height(e)}$("#active-layers-toggle").toggle(function(){$(".lbw.active").each(function(){var e=$(this).prop("id");$('<span id="'+e+'-holder" style="display: none;" />').insertAfter($(this)),$(this).detach().appendTo("#active-layers")}),$(this).html("Show All Layers"),$(".active-layers-label").show(),$("#active-layers").show(),$(".all-layers-label").hide(),$("#map-layers").hide()},function(){$("#active-layers .lbw.active").each(function(){var e=$(this).prop("id");$(this).detach().insertBefore($("#"+e+"-holder")),$("#"+e+"-holder").remove()}),$(this).html("Show Active Layers"),$(".active-layers-label").hide(),$("#active-layers").hide(),$(".all-layers-label").show(),$("#map-layers").show()}),$("#base-layers-toggle").toggle(function(){$("#base").show(),$(this).html("Hide Terrain")},function(){$("#base").hide(),$(this).html("Show Terrain")}),$("#cesiumContainer").click(function(){$(".control-sidebar").hasClass("control-sidebar-open")&&$("#siderbar-toggle").click()}),$("#welcomeModal").modal().on("shown.bs.modal",function(){$("#chat").html('<iframe src="http://tlk.io/cvnews" class="chat-iframe" style="height:600px"></iframe>')}).on("hidden.bs.modal",function(){$("#chat").html(""),$("#tutorial iframe").remove(),$("#tutorial div.youtube").show(),$(".panel-collapse.in").collapse("hide");var e=$(".panel-heading i");e.hasClass("fa-chevron-down")&&e.removeClass("fa-chevron-down").addClass("fa-chevron-right")}),$("#welcome a").click(function(e){e.preventDefault(),$("#welcomeModal").modal().on("shown.bs.modal",function(){$("#chat").html('<iframe src="http://tlk.io/cvnews" class="chat-iframe" style="height:600px"></iframe>')}).on("hidden.bs.modal",function(){$("#chat").html(""),$("#tutorial iframe").remove(),$("#tutorial div.youtube").show(),$(".panel-collapse.in").collapse("hide");var e=$(".panel-heading i");e.hasClass("fa-chevron-down")&&e.removeClass("fa-chevron-down").addClass("fa-chevron-right")})}),$(".control-sidebar").hasClass("control-sidebar-open")&&$("#siderbar-toggle").addClass("active"),!$(".cartodb-layer.active, .bing.active, .arcgis-base-layer.active, .base-layer.active").length>0&&$(".Bing_AERIAL_WITH_LABELS-load").click(),$('[data-bind="foreach: imageryProviderViewModels"]').remove(),$(".shareIncludes").on("click",function(){$(this).hasClass("active")?($(this).removeClass("active"),shareLink()):($(this).addClass("active"),shareLink())}),$(".panel-heading a").on("click",function(){$("i",this).hasClass("fa-chevron-right")?(a(),$("i",this).removeClass("fa-chevron-right").addClass("fa-chevron-down")):(a(),$("i",this).removeClass("fa-chevron-down").addClass("fa-chevron-right"))}),$(".share-active-layers").one("click",function(){$("#includeView").click()}),$(".content-wrapper").show(),resize()});