"use strict";function resize(){var e=$(window).height(),a=$(window).width(),t=767;$(".control-sidebar").height(e-50),$(".main-sidebar").height(e-100),$(".tab-content").height(e-100),$("html").height(e),$("body").height(e),$(".content-wrapper").height(e-50),$("#cesiumContainer").height(e-50).width(a),$(".cesium-viewer").height(e-50).width(a),t>a&&($("#siderbar-toggle i").removeClass("fa-chevron-left").addClass("fa-chevron-right"),$(".control-sidebar").removeClass("control-sidebar-open"))}function getURLParameter(e){for(var a=decodeURIComponent(window.location.search.substring(1)),t=a.split("&"),i=0;i<t.length;i++){var r=t[i].split("=");if(r[0]==e)return r[1]}}function loading(e){$("."+e+"-load").removeClass("fa-play").addClass("fa-spinner fa-spin loading active")}function loaded(e){$("."+e+"-load").removeClass("fa-spinner fa-spin loading").addClass("fa-check")}function loadError(e,a,t){var i=$("#"+e);$('<div class="details"><div class="header"><i class="fa fa-fw fa-exclamation-circle"></i> Load Failed</div>Please use <a href="mailto:jim@climateviewer.com?subject=Climate Viewer 3D broken link - '+e+"&amp;body=Unfortunately this ( "+a+" ) URL is not working properly due to ( "+t+' ), please look into it.  Sent from http://climateviewer.com/3D/" target="_self">this link</a> to report this error.<br><div class="darkwell"><strong>ERROR:</strong> '+t+"</div></div>").appendTo(i);var r=$("."+e+"-load"),o=$("#"+e+" span");r.removeClass("fa-spinner fa-spin active loading").addClass("fa-exclamation-triangle fail"),o.removeClass("active").addClass("fail")}function NSlider(e){var a=e.src,t=e.mod;e=e||{},e.element||(e.element=$('<div class="item slider"></div>')),e.min||(e.min=0),e.max||(e.max=1),e.start||(e.start=1),e.label||(e.label=""),$('<div class="label">'+e.label+"</div>").appendTo(e.element);var i=$('<input class="'+e.label+'" type="range">').appendTo(e.element),r=e.start/e.max*100;return i.attr("min",0),i.attr("max",100),i.attr("step",1),i.attr("value",r),i.on("change",function(){var r=i.val(),o=(r/100).toFixed(2),n=e.max*o;if(t)for(var s=a.entities.values,l=0;l<s.length;l++){var c=s[l],d=c.billboard.color;"alpha"==t&&(c.billboard.color=new Cesium.Color.fromAlpha(d,n))}else"opacity"==e.label&&(a.alpha=n),"contrast"==e.label&&(a.contrast=n),"saturation"==e.label&&(a.saturation=n),"brightness"==e.label&&(a.brightness=n),"gamma"==e.label&&(a.gamma=n)}),e.element}function loadSliders(e,a){var t=$("#"+a+" .lb"),i=$('<div class="details '+a+'-sliders layer-sliders" />').insertAfter(t),r=$('<div class="slider-content" />').appendTo(i),o=$('<div class="ui divided list" />').appendTo(r);NSlider({label:"opacity",src:e}).appendTo(o),NSlider({max:2,label:"brightness",src:e}).appendTo(o),NSlider({max:2,label:"contrast",src:e}).appendTo(o),NSlider({max:2,label:"saturation",src:e}).appendTo(o),e.alpha=1,e.brightness=1,e.contrast=1,e.saturation=1,loaded(a)}function loadGIBS(e,a){removeImagery(e);var t=viewer.imageryLayers.addImageryProvider(new Cesium.WebMapTileServiceImageryProvider({url:"//map1.vis.earthdata.nasa.gov/wmts-webmerc/wmts.cgi?TIME="+a,layer:e,style:"",format:"image/jpeg",tileMatrixSetID:"GoogleMapsCompatible_Level9",maximumLevel:9,tileWidth:256,tileHeight:256,tilingScheme:new Cesium.WebMercatorTilingScheme}));activeLayers[e]=t,$("."+e+"-sliders").remove(),loadSliders(t,e)}function loadWmts(e,a,t){var i=viewer.imageryLayers.addImageryProvider(new Cesium.WebMapTileServiceImageryProvider({url:a,layers:t,style:"",format:"image/png",tileMatrixSetID:"GoogleMapsCompatible_Level9",maximumLevel:9,tileWidth:256,tileHeight:256,tilingScheme:new Cesium.WebMercatorTilingScheme}));activeLayers[e]=i,loadSliders(i,e)}function loadWms(e,a,t,i){var r;r=i?viewer.imageryLayers.addImageryProvider(new Cesium.WebMapServiceImageryProvider({url:a,layers:t,sourceUri:a,enablePickFeatures:!1,parameters:{transparent:!0,format:"image/png"}})):viewer.imageryLayers.addImageryProvider(new Cesium.WebMapServiceImageryProvider({url:a,layers:t,sourceUri:a,parameters:{transparent:!0,format:"image/png"}})),activeLayers[e]=r,loadSliders(r,e)}function loadOsmLayer(e,a){var t=viewer.imageryLayers.addImageryProvider(new Cesium.createOpenStreetMapImageryProvider({url:a}));activeLayers[e]=t,loadSliders(t,e)}function loadCartoDB(e,a){var t=viewer.imageryLayers.addImageryProvider(new Cesium.UrlTemplateImageryProvider({url:a}));activeLayers[e]=t,loadSliders(t,e)}function loadBingLayer(e,a){var t,i="//dev.virtualearth.net",r="AiQDjsWpddVOFEnVY6j4Jb0S0Hoy9QMa30rvbZT1A8qd0it10NkYAgvb5sa3OeLw";t="AERIAL"==a?viewer.imageryLayers.addImageryProvider(new Cesium.BingMapsImageryProvider({url:i,key:r,mapStyle:Cesium.BingMapsStyle.AERIAL})):"AERIAL_WITH_LABELS"==a?viewer.imageryLayers.addImageryProvider(new Cesium.BingMapsImageryProvider({url:i,key:r,mapStyle:Cesium.BingMapsStyle.AERIAL_WITH_LABELS})):viewer.imageryLayers.addImageryProvider(new Cesium.BingMapsImageryProvider({url:i,key:r,mapStyle:Cesium.BingMapsStyle.ROADS})),activeLayers[e]=t,loadSliders(t,e)}function newMarkerLabel(e,a){var t=new Cesium.LabelGraphics;return"usgs-eq"==a?t.text="M"+e.properties.mag:e.label.text?t.text=e.label.text:t.text="",t.horizontalOrigin=Cesium.HorizontalOrigin.CENTER,t.verticalOrigin=Cesium.VerticalOrigin.BOTTOM,t.outlineWidth=5,t.style=Cesium.LabelStyle.FILL_AND_OUTLINE,t.translucencyByDistance=defaultTranslucency,t.eyeOffset=defaultKMLEyeOffset,t}function modMarkers(e,a,t,i,r,o){if(o===!1)var n=$("."+e+"-details"),s=$('<div class="details '+e+'-list marker-list" />').insertAfter(n),l=[];for(var c=a.entities.values,d=0;d<c.length;d++){var m=c[d];console.log(m);var h,p=new Cesium.BillboardGraphics;h=t?t:m.billboard.image?m.billboard.image:"/img/icons/cv3d.png",p.image=h;var g;g="usgs-eq"==r?m.properties.mag:i?i:3;var u,f;if(u=m.properties.title?"<h3>"+m.properties.title+"</h3>":m.properties.Name?"<h3>"+m.properties.Name+"</h3>":m.properties.name?"<h3>"+m.properties.name+"</h3>":m.properties.LICENSEE?"<h3>"+m.properties.LICENSEE+"</h3>":"",f=m.properties.mag?"<div>Place: "+m.properties.place+"<br>Magnitude: "+m.properties.mag+'<br><a href="'+m.properties.url+'" target="_blank">Click here for more info.</a></div>':m.properties.Description?"<div>"+m.properties.Description+"</div>":m.properties.description?"<div>"+m.properties.description+"</div>":m.properties.desc?"<div>"+m.properties.desc+"</div>":m.properties.FREQUENCY?"<div>FREQUENCY: "+m.properties.FREQUENCY+"<br>CALLSIGN: "+m.properties.CALLSIGN+"<br>SERVICE: "+m.properties.SERVICE+"<br></div>":"",m.title=u,m.description=f,p.scale=g,p.width=32,p.height=32,p.alignedAxis=Cesium.Cartesian3.ZERO,p.scaleByDistance=defaultScaleByDistance,m.billboard=p,o===!1){var v=m.position.getValue(),y=Cesium.Ellipsoid.WGS84.cartesianToCartographic(v),w=Cesium.Math.toDegrees(y.longitude),b=Cesium.Math.toDegrees(y.latitude);l.push('<li data-lon="'+w+'"  data-lat="'+b+'">'+m.title+"</li>")}r&&(m.label=newMarkerLabel(m,r))}o===!1&&($('<h5><i class="fa fa-fw fa-map-marker"></i> Map Markers</h5>').appendTo(s),$("<ol/>",{"class":"markers",html:l.join("")}).appendTo(s),$(".markers li").click(function(){var e=$(this).attr("data-lon"),a=$(this).attr("data-lat");viewer.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(e,a,3e3)})}))}function loadArcGisLayer(e,a,t,i,r,o){var n;n=i?r?viewer.imageryLayers.addImageryProvider(new Cesium.ArcGisMapServerImageryProvider({url:a,enablePickFeatures:!1,tileWidth:r,tileHeight:o,layers:t})):viewer.imageryLayers.addImageryProvider(new Cesium.ArcGisMapServerImageryProvider({url:a,enablePickFeatures:!1,layers:t})):r?viewer.imageryLayers.addImageryProvider(new Cesium.ArcGisMapServerImageryProvider({url:a,enablePickFeatures:!0,tileWidth:r,tileHeight:o,layers:t})):viewer.imageryLayers.addImageryProvider(new Cesium.ArcGisMapServerImageryProvider({url:a,enablePickFeatures:!0,layers:t})),activeLayers[e]=n,loadSliders(n,e),loaded(e)}function loadGeoJson(e,a,t,i,r,o,n){new Cesium.GeoJsonDataSource.load(a).then(function(a){modMarkers(e,a,r,i,t,n),viewer.dataSources.add(a),activeLayers[e]=a,o&&(o===!0?viewer.flyTo(a):$(".cesium-home-button").trigger("click")),loaded(e)},function(t){loadError(e,a,t)})}function loadKml(e,a,t,i,r,o,n,s){t?new Cesium.KmlDataSource.load(a,{proxy:{getURL:function(e){return"/proxy.php/"+e}},sourceUri:a}).then(function(a){s&&modMarkers(a,r,o,n),viewer.dataSources.add(a),activeLayers[e]=a,i&&(i===!0?viewer.flyTo(a):$(".cesium-home-button").trigger("click")),loaded(e)},function(t){loadError(e,a,t)}):new Cesium.KmlDataSource.load(a).then(function(a){s&&modMarkers(a,r,o,n),viewer.dataSources.add(a),activeLayers[e]=a,i&&(i===!0?viewer.flyTo(a):$(".cesium-home-button").trigger("click")),loaded(e)},function(t){loadError(e,a,t)})}function removeImagery(e){var a=activeLayers[e];delete activeLayers[e],viewer.imageryLayers.remove(a,!1)}function disableLayer(e){var a=e.I,t=e.T;if(void 0!==layerEnabled[e.I]){if("nasa-gibs"===t||"cartodb-layer"===t||"wmts"===t||"wms"===t||"base-layer"===t||"arcgis"===t||"arcgis-base-layer"===t||"arcgis-layer"===t||"bing"===t)removeImagery(a),$("."+a+"-sliders").remove();else{var i=activeLayers[a];delete activeLayers[a],viewer.dataSources.remove(i)}("geojson"===t||"kml"===t)&&($("."+a+"-tree").removeClass("active"),$("."+a+"-list").remove()),delete layerEnabled[a]}}function updateLayer(e,a){loading(e);var t=me.node(e);t||console.error("missing layer",e);var i=t.G,r=t.L,o=t.HT,n=t.W,s=t.M,l=t.MI,c=t.MS,d=t.ML,m=t.C,p=t.Y,h=t.P,g=t.X,u=picker.get("select","yyyy-mm-dd");if(!a)var f=t.Z;p=p?!0:!1,void 0===layerEnabled[e]&&(layerEnabled[e]=!1,"wms"===t.T?loadWms(e,i,r,g):"nasa-gibs"===t.T?loadGIBS(e,u):"wtms"===t.T?loadWmts(e,i,r):"cartodb-layer"===t.T?loadCartoDB(e,i):"base-layer"===t.T?loadOsmLayer(e,i):"arcgis"===t.T||"arcgis-layer"===t.T||"arcgis-base-layer"===t.T?loadArcGisLayer(e,i,r,g,n,o):"geojson"===t.T?loadGeoJson(e,i,d,c,l,f,p):"kml"===t.T?loadKml(e,i,h,f,l,c,d,s):"bing"===t.T?loadBingLayer(e,i):console.log(e+" failed to load map type: "+t.T),m&&toggleTimeline(!0))}function newFolderLabel(e,a,t){if(t)var i='<i class="fa fa-fw '+t+'"></i>';else i="";var r=$("<h2>").addClass("toggle").html(i+e.N).click(function(){a.is(":visible")?(a.hide(),r.removeClass("active")):(a.show(),r.addClass("active"))});return r}function initDetails(e,a,t,i,r,o){var n=$('<div class="details '+e+'-content" />').appendTo(t);$('<div class="header"><i class="fa fa-fw fa-info-circle"></i> Layer Details</div><span>'+i+' &bull; <a href="'+r+'" target="_blank" rel="nofollow">More Info</a></span>').appendTo(n),"kml"==a&&$('<div class="header"><i class="fa fa-fw fa-download"></i> Data Source</div><span>Keyhole Markup Language (KML) &bull; <a href="'+o+'">Download</a></span>').appendTo(n),"geojson"==a&&$('<div class="header"><i class="fa fa-fw fa-download"></i> Data Source</div><span>GeoJSON &bull; <a href="'+o+'">Download</a></span>').appendTo(n),"nasa-gibs"==a&&$('<div class="header"><i class="fa fa-fw fa-file-o"></i> Data Source</div><span>Web Map Tile Service (WMTS)</span>').appendTo(n),"wms"==a&&$('<div class="header"><i class="fa fa-fw fa-file-o"></i> Data Source</div><span>Web Mapping Service (WMS)<br><a target="_blank" rel="nofollow" href="'+o+'?request=GetCapabilities&service=WMS">Get Capabilities</a></span>').appendTo(n),"base-layer"==a&&$('<div class="header"><i class="fa fa-fw fa-file-o"></i> Data Source</div><span>OpenStreetMap (OSM) Base Map</span>').appendTo(n),("arcgis"==a||"arcgis-layer"==a)&&$('<div class="header"><i class="fa fa-fw fa-file-o"></i> Data Source</div><span>ArcGIS MapServer<br><a target="_blank" rel="nofollow" href="'+o+'/legend">Map Legend</a> &bull; <a target="_blank" rel="nofollow" href="'+o+'">MapServer Information</a></span>>').appendTo(n),$('<div class="header"><i class="fa fa-share-square-o fa-fw"></i> Share This Layer</div><span>Use this url to share this layer: <a href="'+homeURL+"index.html?layersOn="+e+'" target="_self">Share Link</a><span><div class="header"><i class="fa fa-exclamation-triangle fa-fw"></i> Report Error</div><span>If you are experiencing problems loading this layer, or you would like to suggest corrections, comments, or concerns, please email me using this link: <a href="mailto:jim@climateviewer.com?subject=Climate Viewer broken link - '+e+"&amp;body=Unfortunately this ( "+o+' ) URL is not working properly, please look into it. Sent from http://climateviewer.com/3D/" target="_self">Report Error</a></span>').appendTo(n)}function addTree(e,a,t){var i=me.successors(e);return _.each(i,function(e){var r,i=me.node(e),o=i.I,n=i.T,s=$('<div class="folder" />').html(i);if(i.T){var c=!0;if(c){var v,y,w,b,k,S,C,d=i.G,m=i.S,p=i.U,h=i.H,g=i.NL,u=i.C,f=i.Y;f!==!0&&(f=!1),console.log(f),r=$("<div>").data("l",i).attr("id",i.I).addClass("lbw").addClass(i.T),v=$("<div>").addClass("lb").appendTo(r),b=$("<i>").addClass("fa fa-fw fa-folder-o").toggle(function(){0==y.children().length&&initDetails(o,n,y,m,p,d),y.show(),y.focus(),b.removeClass("fa-folder-o").addClass("fa-folder-open-o active")},function(){y.hide(),b.removeClass("fa-folder-open-o active").addClass("fa-folder-o")}).appendTo(v),"geojson"===i.T&&f===!1&&(k=$('<i title="Expand Marker Tree" class="fa fa-fw fa-sitemap toggle-list '+o+'-tree"></i>'),k.click(function(){setTimeout(function(){$("."+o+"-list").is(":visible")?($("."+o+"-list").hide(),k.removeClass("active")):($("."+o+"-list").show(),k.addClass("active"))})}).appendTo(v)),("nasa-gibs"===i.T||"cartodb-layer"===i.T||"wmts"===i.T||"wms"===i.T||"base-layer"===i.T||"arcgis"===i.T||"arcgis-layer"===i.T||"bing"===i.T)&&(S=$('<i title="Expand Marker Tree" class="fa fa-fw fa-sliders toggle-list '+o+'-tree"></i>'),S.click(function(){setTimeout(function(){$("."+o+"-sliders").is(":visible")?($("."+o+"-sliders").hide(),S.removeClass("show-sliders")):($("."+o+"-sliders").show(),S.addClass("show-sliders"))})}).appendTo(v)),w=$('<i class="fa fa-fw fa-play '+o+'-load"></i>'),h&&w.addClass("large-layer"),g&&w.addClass("new-layer"),w.toggle(function(){setTimeout(function(){w.hasClass("fa-play")&&(t?updateLayer(o,t):updateLayer(o),y.is(":visible")&&$("."+i.I+"-picker").show(),C.hasClass("active")||C.addClass("active"),r.hasClass("active")||r.addClass("active"),u&&toggleTimeline(!0),"geojson"===i.T&&f===!1&&k.show(),("nasa-gibs"===i.T||"cartodb-layer"===i.T||"wmts"===i.T||"wms"===i.T||"base-layer"===i.T||"arcgis"===i.T||"arcgis-layer"===i.T||"bing"===i.T)&&S.show())})},function(){setTimeout(function(){w.hasClass("fa-check")&&(disableLayer(i),w.removeClass("fa-check active").addClass("fa-play"),C.hasClass("active")&&C.removeClass("active"),r.hasClass("active")&&r.removeClass("active"),b.hasClass("fa-folder-open-o")&&b.trigger("click"),"geojson"===i.T&&f===!1&&k.hide(),("nasa-gibs"===i.T||"cartodb-layer"===i.T||"wmts"===i.T||"wms"===i.T||"base-layer"===i.T||"arcgis"===i.T||"arcgis-layer"===i.T||"bing"===i.T)&&(S.hide(),S.removeClass("show-sliders")))})}).appendTo(v),C=$("<span>").html(i.N).addClass("label"),C.toggle(function(){C.hasClass("fail")||(C.hasClass("active")||C.addClass("active"),w.trigger("click"))},function(){C.hasClass("fail")||(C.hasClass("active")&&C.removeClass("active"),w.trigger("click"))}).appendTo(v),y=$('<div class="ui card '+o+'-details layer-details" />').appendTo(r),y.hide()}}else{var l=i.icon;r=newFolderLabel(i,s,l)}if(null!=r){a.append(r);var M=addTree(i.I,s,t);M.length&&a.append(s)}}),i}function initLayers(e){var a=$("#map-layers");a.addClass("ui"),e?_.each(me.sources(),function(t){addTree(t,a,e)}):_.each(me.sources(),function(e){addTree(e,a)})}function toggleTimeline(e){if(e)animationContainer.show(),timelineContainer.show(),$(".toggle-timeline").addClass("active");else if(animationContainer.is(":visible"))animationContainer.hide(),timelineContainer.hide(),$(".toggle-timeline").removeClass("active");else{animationContainer.show(),timelineContainer.show();var a=Cesium.JulianDate.fromDate(new Date(Date.UTC(2012,4,8))),t=Cesium.JulianDate.now();viewer.timeline.zoomTo(a,t),$(".toggle-timeline").addClass("active")}}function shareLink(){function i(){$("#includeView").prop("disabled",!0).parent().prop("title","Not available in 2D or Flat Earth mode yet.")}function w(e){var a=e,t="r3zn8d",i="b5c2d6d1704074b0741a7449a98e3fcef2790699";$.ajax({url:"https://api-ssl.bitly.com/v3/shorten",data:{longUrl:a,access_token:i,login:t},dataType:"jsonp",success:function(e){var a=e.data.url;$("#result").html('<a href="'+a+'" target="_self">'+a+"</a>")}})}var e="",a="",t=shareURL;if($(".geojson.active, .kml.active, .arcgis.active, .wms.active, .wtms.active, .nasa-gibs.active").each(function(){var a=$(this);if(a.hasClass("active")){var t=a.attr("id");e+=t+","}}),$(".cartodb-layer.active, .bing.active, .arcgis-base-layer.active, .base-layer.active").each(function(){var e=$(this);if(e.hasClass("active")){var t=e.attr("id");a+=t+","}}),t+="index.html?",e.length>0&&(e=e.substring(0,e.length-1),t+="layersOn="+e),a.length>0&&(a=a.substring(0,a.length-1),t+="&baseLayers="+a),$(".mode-2D").hasClass("active"))t+="&mode=2D",i();else if($(".mode-flat").hasClass("active"))t+="&mode=flat",i();else if($("#includeView").hasClass("active")){$("#includeView").prop("disabled",!1).parent().prop("title","");var r=viewer.scene,o=r.camera,n=new Cesium.Cartesian2(viewer.container.clientWidth/2,viewer.container.clientHeight/2),s=viewer.scene.camera.getPickRay(n),l=viewer.scene.globe.pick(s,viewer.scene),c=viewer.scene.globe.ellipsoid.cartesianToCartographic(l),d=o.positionCartographic.height,m=c.longitude*(180/Math.PI),p=c.latitude*(180/Math.PI),h=m.toFixed(5),g=p.toFixed(5),u=d.toFixed(2);t+="&lat="+h,t+="&lon="+g,t+="&zoom="+u,t+="&mode=3D"}var f=picker.get("select","yyyy-mm-dd");t+="&date="+f;var v=$(".share-all-layers");v.attr("href",t).html(t);encodeURIComponent(t);w(t)}function openPicker(){$("#datepicker").pickadate("picker").open(),console.log("clicked")}$(window).resize(function(){resize()});var imageryViewModels=[];Cesium.BingMapsApi.defaultKey="AiQDjsWpddVOFEnVY6j4Jb0S0Hoy9QMa30rvbZT1A8qd0it10NkYAgvb5sa3OeLw";var terrainProviders=[];terrainProviders.push(new Cesium.ProviderViewModel({name:"STK World Terrain meshes",iconUrl:Cesium.buildModuleUrl("Widgets/Images/TerrainProviders/STK.png"),tooltip:"High-resolution, mesh-based terrain for the entire globe. Free for use on the Internet. Closed-network options are available.\nhttp://www.agi.com",creationFunction:function(){return new Cesium.CesiumTerrainProvider({url:"//assets.agi.com/stk-terrain/world",requestWaterMask:!0,requestVertexNormals:!0})}})),terrainProviders.push(new Cesium.ProviderViewModel({name:"WGS84 Ellipsoid",iconUrl:Cesium.buildModuleUrl("Widgets/Images/TerrainProviders/Ellipsoid.png"),tooltip:"WGS84 standard ellipsoid, also known as EPSG:4326",creationFunction:function(){return new Cesium.EllipsoidTerrainProvider}}));var now=Cesium.JulianDate.now(),clock=new Cesium.Clock({currentTime:now}),viewer;viewer=$("body").hasClass("mobile")?new Cesium.Viewer("cesiumContainer",{sceneModePicker:!1,timeline:!0,animation:!0,sceneMode:Cesium.SceneMode.SCENE3D,navigationHelpButton:!0,navigationInstructionsInitiallyVisible:!1,imageryProvider:!1,baseLayerPicker:!1,clock:clock,terrainProvider:!1,skyAtmosphere:!1,skyBox:!1,targetFrameRate:15}):new Cesium.Viewer("cesiumContainer",{sceneModePicker:!1,timeline:!0,animation:!0,sceneMode:Cesium.SceneMode.SCENE3D,navigationHelpButton:!0,navigationInstructionsInitiallyVisible:!0,imageryProvider:!1,baseLayerPicker:!1,clock:clock,terrainProvider:!1,targetFrameRate:60}),viewer.resolutionScale=1/devicePixelRatio,viewer.scene.imageryLayers.removeAll(),viewer.scene.globe.baseColor=Cesium.Color.BLACK;var baseLayerPicker=new Cesium.BaseLayerPicker("baseLayerPickerContainer",{globe:viewer.scene,imageryProviderViewModels:imageryViewModels,terrainProviderViewModels:terrainProviders}),homeURL=window.location.protocol+"//"+window.location.host+"/3D/",shareURL="http://climateviewer.org/3D/",proxyURL="/proxy.php",activeLayers={},infoBox=$(".cesium-infoBox"),layerEnabled={},me=Self();nobjectsIn(layers,function(e){},function(e,a,t){me.addEdge(e,a,t)});var date=new Date;date.setDate(date.getDate()-1);var yesterday=Cesium.JulianDate.fromDate(date),time=Cesium.JulianDate.toDate(yesterday),$input=$("#datepicker").pickadate({format:"mmmm d, yyyy",formatSubmit:"yyyy-mm-dd",min:[2012,4,8],max:Cesium.JulianDate.now(),container:"#datepicker-container",closeOnSelect:!0,closeOnClear:!1,selectYears:!0,selectMonths:!0}),picker=$input.pickadate("picker");picker.set("select",time),picker.on({set:function(){var e=picker.get("select","yyyy-mm-dd");console.log(e),$(".nasa-gibs.active").each(function(){loadGIBS($(this).attr("id"),e)})}});var start=picker.get("select","yyyy-mm-dd"),previousTime=null,isoDate=function(e){return e.split("T")[0]},isoDateTime=clock.currentTime.toString(),time="TIME="+isoDate(isoDateTime),onClockUpdate=_.throttle(function(){var e=clock.currentTime.toString(),a=isoDate(e);a!==previousTime&&(previousTime=a,picker.set("select",a,{format:"yyyy-mm-dd"}))},250,{leading:!0,trailing:!0});viewer.clock.onTick.addEventListener(onClockUpdate),onClockUpdate();var defaultKMLEyeOffset=new Cesium.Cartesian3(0,5e3,0),defaultScaleByDistance=new Cesium.NearFarScalar(1,.5,1,.3),defaultTranslucency=new Cesium.NearFarScalar(150,1,3e6,0),animationContainer=$(".cesium-viewer-animationContainer"),timelineContainer=$(".cesium-viewer-timelineContainer"),credit=$(".cesium-viewer-bottom");animationContainer.hide(),timelineContainer.hide(),credit.hide(),$(".toggle-timeline").click(function(e){e.preventDefault(),toggleTimeline()});var startTime=Cesium.JulianDate.fromDate(new Date(Date.UTC(2012,4,8))),endTime=Cesium.JulianDate.now();viewer.timeline.zoomTo(startTime,endTime),$(".mode-3D").click(function(){viewer.scene.morphTo3D(),$(".map-mode div.active").removeClass("active"),$(this).addClass("active")}),$(".mode-2D").click(function(){viewer.scene.morphTo2D(),$(".map-mode div.active").removeClass("active"),$(this).addClass("active")}),$(".mode-flat").click(function(){viewer.scene.morphToColumbusView(),$(".map-mode div.active").removeClass("active"),$(this).addClass("active")});var initialLayers=(getURLParameter("layersOn")||"").split(","),initialBaseLayers=(getURLParameter("baseLayers")||"").split(","),disabledLayers=(getURLParameter("layersOff")||"").split(",");""===initialLayers[0]&&(initialLayers=[]),""===disabledLayers[0]&&(disabledLayers=[]);var allLayers=initialLayers.concat(disabledLayers),baseLayers=initialBaseLayers.concat();if(allLayers.length>0){var latView=getURLParameter("lat")||"-78.176832746519",lonView=getURLParameter("lon")||"31.300283760032368",zoomView=getURLParameter("zoom")||"26596280.257583864",dateView=getURLParameter("date")||time,modeView=getURLParameter("mode")||"3D";if(dateView!==time&&picker.set("select",dateView,{format:"yyyy-mm-dd"}),modeView&&(console.log(".mode-"+modeView),$(".mode-"+modeView).click()),"-78.176832746519"!==latView){var includeOnly=!0;initLayers(includeOnly),viewer.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(latView,lonView,zoomView)})}else initLayers();var shared=$('<div class="folder" style="display: block;"></div>').prependTo("#map-layers");if($('<h2 class="toggle active">Shared Layers</h2>').prependTo("#map-layers").show(),baseLayers.length>0)for(var i=0;i<baseLayers.length;i++)$("."+initialBaseLayers[i]+"-load").click();for(var i=0;i<allLayers.length;i++)$("#"+allLayers[i]).detach().appendTo(shared).show();for(var i=0;i<initialLayers.length;i++)$("."+initialLayers[i]+"-load").click()}else initLayers();$(".share-active-layers").click(function(e){e.preventDefault(),shareLink(),$("#shareModal").modal()}),$(".report-tab").click(function(e){e.preventDefault();var a=$(window).width(),t=$(window).height();return 1024>a?(window.open("https://climateviewer.crowdmap.com/","","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height="+t+",width="+a),!1):(window.open("https://climateviewer.crowdmap.com/","","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=800,width=1024"),!1)}),$(".clear-layers").click(function(e){e.preventDefault(),$("i.active").trigger("click"),$(".Bing_AERIAL_WITH_LABELS-load").click()}),$(".collapse-menu").click(function(e){e.preventDefault(),$(".fa-folder-open-o.active").trigger("click"),$(".folder h2.active").trigger("click"),$("h2.active").trigger("click")}),$(".top-layers").click(function(e){e.preventDefault(),$(".tab-content").animate({scrollTop:$("#top").offset().top-90},500)}),$(".sun-control").toggle(function(e){e.preventDefault(),viewer.scene.globe.enableLighting=!0,$(this).addClass("active")},function(e){e.preventDefault(),viewer.scene.globe.enableLighting=!1,$(this).removeClass("active")}),$(".about-jim").click(function(e){e.preventDefault(),window.location="https://climateviewer.com/rezn8d/"}),$(".reset-view").click(function(e){e.preventDefault(),$(".cesium-home-button").trigger("click")}),$(".date-icon").click(function(e){e.preventDefault(),e.stopPropagation(),openPicker()}),$(".cesium-baseLayerPicker-dropDown").addClass("cesium-baseLayerPicker-dropDown-visible").detach().appendTo($("#base")),$(".cesium-viewer-geocoderContainer").detach().prependTo($(".search")),$(".cesium-geocoder-input").addClass("cesium-geocoder-input-wide"),$(document).ready(function(){function a(){$(".panel-heading a i.fa-chevron-down").removeClass("fa-chevron-down").addClass("fa-chevron-right")}if($(".youtube").each(function(){$(this).css("background-image","url(http://i.ytimg.com/vi/"+this.id+"/sddefault.jpg)"),$(this).append($("<div/>",{"class":"play"})),$(document).delegate("#"+this.id,"click",function(){var e="https://www.youtube.com/embed/"+this.id+"?autoplay=1&autohide=1";$(this).data("params")&&(e+="&"+$(this).data("params"));var a=$("<iframe/>",{frameborder:"0",src:e,width:$(this).width(),height:$(this).height()});$(this).hide(),$("#tutorial").append(a)})}),$(".resources-intro")){var e=$(window).height();$(".resources-intro").height(e)}$("#active-layers-toggle").toggle(function(){$(".lbw.active").each(function(){var e=$(this).prop("id");$('<span id="'+e+'-holder" style="display: none;" />').insertAfter($(this)),$(this).detach().appendTo("#active-layers")}),$(this).html("Show All Layers"),$(".active-layers-label").show(),$("#active-layers").show(),$(".all-layers-label").hide(),$("#map-layers").hide()},function(){$("#active-layers .lbw.active").each(function(){var e=$(this).prop("id");$(this).detach().insertBefore($("#"+e+"-holder")),$("#"+e+"-holder").remove()}),$(this).html("Show Active Layers"),$(".active-layers-label").hide(),$("#active-layers").hide(),$(".all-layers-label").show(),$("#map-layers").show()}),$("#base-layers-toggle").toggle(function(){$("#base").show(),$(this).html("Hide Terrain")},function(){$("#base").hide(),$(this).html("Show Terrain")}),$("#cesiumContainer").click(function(){$(".control-sidebar").hasClass("control-sidebar-open")&&$("#siderbar-toggle").click()}),$("#welcomeModal").modal().on("shown.bs.modal",function(){$("#chat").html('<iframe src="http://tlk.io/cvnews" class="chat-iframe" style="height:600px"></iframe>')}).on("hidden.bs.modal",function(){$("#chat").html(""),$("#tutorial iframe").remove(),$("#tutorial div.youtube").show(),$(".panel-collapse.in").collapse("hide");var e=$(".panel-heading i");e.hasClass("fa-chevron-down")&&e.removeClass("fa-chevron-down").addClass("fa-chevron-right")}),$("#welcome a").click(function(e){e.preventDefault(),$("#welcomeModal").modal().on("shown.bs.modal",function(){$("#chat").html('<iframe src="http://tlk.io/cvnews" class="chat-iframe" style="height:600px"></iframe>')}).on("hidden.bs.modal",function(){$("#chat").html(""),$("#tutorial iframe").remove(),$("#tutorial div.youtube").show(),$(".panel-collapse.in").collapse("hide");var e=$(".panel-heading i");e.hasClass("fa-chevron-down")&&e.removeClass("fa-chevron-down").addClass("fa-chevron-right")})}),$(".control-sidebar").hasClass("control-sidebar-open")&&$("#siderbar-toggle").addClass("active"),!$(".cartodb-layer.active, .bing.active, .arcgis-base-layer.active, .base-layer.active").length>0&&$(".Bing_AERIAL_WITH_LABELS-load").click(),$('[data-bind="foreach: imageryProviderViewModels"]').remove(),$(".shareIncludes").on("click",function(){$(this).hasClass("active")?($(this).removeClass("active"),shareLink()):($(this).addClass("active"),shareLink())}),$(".panel-heading a").on("click",function(){$("i",this).hasClass("fa-chevron-right")?(a(),$("i",this).removeClass("fa-chevron-right").addClass("fa-chevron-down"),shareLink()):(a(),$("i",this).removeClass("fa-chevron-down").addClass("fa-chevron-right"),shareLink())}),$(".share-active-layers").one("click",function(){$("#includeView").click(),$("#includeDate").click()}),$(".content-wrapper").show(),resize()});