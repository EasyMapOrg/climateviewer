"use strict";function isUrlValid(e){return/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(e)}function geturl(e){return e.length>20?e.substr(0,20)+"...":e}function convertlink(e){return e.replace(urlRegex,function(e){return'<a href="'+e+'">'+geturl(e)+"</a>"})}function resize(){var e=$(window).height(),a=$(window).width(),t=767;$(".control-sidebar").height(e-50),$(".main-sidebar").height(e-100),$(".tab-content").height(e-100),$("html").height(e),$("body").height(e),$(".content-wrapper").height(e-50),$("#map").height(e-50).width(a),t>a&&($("#siderbar-toggle i").removeClass("fa-chevron-left").addClass("fa-chevron-right"),$(".control-sidebar").removeClass("control-sidebar-open"))}function getURLParameter(e){for(var a=decodeURIComponent(window.location.search.substring(1)),t=a.split("&"),r=0;r<t.length;r++){var i=t[r].split("=");if(i[0]==e)return i[1]}}function loading(e){$("."+e+"-load").removeClass("fa-play").addClass("fa-spinner fa-spin loading active")}function loaded(e){$("."+e+"-load").removeClass("fa-spinner fa-spin loading").addClass("fa-check")}function loadError(e,a,t){var r=$("#"+e);$('<div class="ui card layer-sliders" style="display:block"><div class="content"><div class="ui divided list"><div class="item"><i class="circular inverted warning icon"></i><div class="content"><div class="header">Load Failed</div>Please use <a href="mailto:jim@climateviewer.com?subject=Climate Viewer broken link - '+e+"&amp;body=Unfortunately this ( "+a+" ) URL is not working properly due to ( "+t+' ), please look into it.  Sent from http://climateviewer.com/mobile/" target="_blank">this link</a> to report this error.<br><br><strong>ERROR:</strong> '+t+"</div></div></div></div>").appendTo(r);var i=$("."+e+"-load"),o=$("#"+e+" span");i.removeClass("spinner loading").addClass("close fail"),o.removeClass("active").addClass("fail")}function NSlider(e){var a=e.src;e.mod;e=e||{},e.element||(e.element=$('<div class="item slider"></div>')),e.min||(e.min=0),e.max||(e.max=1),e.start||(e.start=1),e.label||(e.label=""),$('<div class="label">'+e.label+"</div>").appendTo(e.element);var r=$('<input class="'+e.label+'" type="range">').appendTo(e.element),i=e.start/e.max*100;return r.attr("min",0),r.attr("max",100),r.attr("step",1),r.attr("value",i),r.on("change",function(){var t=r.val(),i=(t/100).toFixed(2),o=e.max*i;"opacity"==e.label&&a.setOpacity(o)}),e.element}function loadSliders(e,a,t){var r=$("#"+a+" .lb"),i=$('<div class="details '+a+'-sliders layer-sliders" />').insertAfter(r),o=$('<div class="slider-content" />').appendTo(i),s=$('<div class="ui divided list" />').appendTo(o);NSlider({label:"opacity",src:e}).appendTo(s);var n=$("."+a+"-details");if(t){var l=$("."+a+"-picker");n.is(":visible")&&(i.show(),l.show())}else n.is(":visible")&&i.show();loaded(a)}function loadGIBS(e,a,t,r){var i="//map1{s}.vis.earthdata.nasa.gov/wmts-webmerc/{layer}/default/{time}/{tileMatrixSet}/{z}/{y}/{x}.jpg";activeLayers[e]&&removeImagery(e);var o=new L.LayerGroup,s=L.tileLayer(i,{layer:e,format:t,tileMatrixSet:"GoogleMapsCompatible_Level"+r,maxZoom:r,time:a,subdomains:"abc",noWrap:!1,continuousWorld:!1,bounds:[[-85.0511287776,-179.999999975],[85.0511287776,179.999999975]],attribution:"<a href='https://wiki.earthdata.nasa.gov/display/GIBS' target='_blank'>NASA EOSDIS GIBS</a>&nbsp;&nbsp;&nbsp;<a href='https://github.com/nasa-gibs/web-examples/blob/release/examples/leaflet/webmercator-epsg3857.js' target='_blank'>View Source</a>"});o.addLayer(s),o.addTo(map),activeLayers[e]=o,$("."+e+"-sliders").remove(),loadSliders(s,e)}function loadWmts(e,a,t){var r=new L.LayerGroup,i=viewer.imageryLayers.addImageryProvider(new Cesium.WebMapTileServiceImageryProvider({url:a,layers:t,style:"",format:"image/png",tileMatrixSetID:"GoogleMapsCompatible_Level9",maximumLevel:9,tileWidth:256,tileHeight:256,tilingScheme:new Cesium.WebMercatorTilingScheme}));r.addLayer(i),r.addTo(map),activeLayers[e]=r,loadSliders(i,e)}function loadWms(e,a,t){var r=new L.LayerGroup,i=L.tileLayer.wms(a,{layers:t,format:"image/png",transparent:!0}).setZIndex("200");r.addLayer(i),r.addTo(map),activeLayers[e]=r,loadSliders(i,e)}function loadOsmLayer(e,a){var t=new L.LayerGroup,r=L.tileLayer(a+"{z}/{x}/{y}.png",{zIndex:2,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions" target="_blank">CartoDB</a>',subdomains:"abcd",maxZoom:19});t.addLayer(r),t.addTo(map),activeLayers[e]=t,loadSliders(r,e)}function loadCartoDB(e,a){var t=new L.LayerGroup,r=L.tileLayer(a,{zIndex:1,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',maxZoom:19});t.addLayer(r),t.addTo(map),activeLayers[e]=t,loadSliders(r,e)}function loadBingLayer(e,a){var r,t=new L.LayerGroup,i="AiQDjsWpddVOFEnVY6j4Jb0S0Hoy9QMa30rvbZT1A8qd0it10NkYAgvb5sa3OeLw";r="AERIAL"==a?new L.BingLayer(i,{type:"Aerial"}):"AERIAL_WITH_LABELS"==a?new L.BingLayer(i,{type:"AerialWithLabels"}):new L.BingLayer(i,{type:"Road"}),t.addLayer(r),t.addTo(map),activeLayers[e]=t,loadSliders(r,e)}function loadArcGisLayer(e,a,t){var r=new L.LayerGroup,i=L.esri.dynamicMapLayer({url:a,layers:[t],opacity:1,useCors:!1});i.bindPopup(function(e,a){var r,i,t=a.features[0];if(i=$("<p />"),r="<h3>Details</h3>",e||0===a.features.length)return!1;var o=$("#feature-content"),s=$("<p/>").appendTo(o);$.map(t.properties,function(e,a){$("<strong>"+a+"</strong>&nbsp;&bull;&nbsp;<span>"+(isUrlValid(e)?'<a href="'+e+'" target="_blank">'+e+"</a>":e)+"</span><br>").appendTo(s)}),$("#featureModal").modal("show").modal({onHidden:function(){$(".null").remove()}})}),r.addLayer(i),r.addTo(map),activeLayers[e]=r,loadSliders(i,e)}function loadArcGisBasemap(e,a){var t=new L.LayerGroup,r=L.tileLayer(a+"/tile/{z}/{y}/{x}",{zIndex:2,attribution:"Copyright:Â© 2013 ESRI, i-cubed, GeoEye",subdomains:"abcd",maxZoom:19});t.addLayer(r),t.addTo(map),activeLayers[e]=t,loadSliders(r,e)}function loadKml(e,a,t,r){var s,i=new L.LayerGroup,o=proxyURL+a;s=t?o:a;var n;n=s.indexOf(".kmz")>=0||s.indexOf("MapServer")>=0?new L.KMZ(s,{imageOverlayBoundingBoxCreatePopUp:!0,imageOverlayBoundingBoxDrawOptions:{stroke:!0,weight:2,fillOpacity:.05,clickable:!0}},"KMZ"):new L.KML(s,{async:!0}),n.on("loaded",function(a){$(a.features).each(function(e,a){L.KML(a,{onEachFeature:function(e,a){if(e.properties){var t,r;t=e.properties.title?"<h3>"+e.properties.title+"</h3>":e.properties.Name?"<h3>"+e.properties.Name+"</h3>":e.properties.name?"<h3>"+e.properties.name+"</h3>":e.properties.LICENSEE?"<h3>"+e.properties.LICENSEE+"</h3>":"",r=e.properties.mag?"<div>Place: "+e.properties.place+"<br>Magnitude: "+e.properties.mag+'<br><a href="'+e.properties.url+'" target="_blank">Click here for more info.</a></div>':e.properties.Description?"<div>"+e.properties.Description+"</div>":e.properties.description?"<div>"+e.properties.description+"</div>":e.properties.desc?"<div>"+e.properties.desc+"</div>":e.properties.FREQUENCY?"<div>FREQUENCY: "+e.properties.FREQUENCY+"<br>CALLSIGN: "+e.properties.CALLSIGN+"<br>SERVICE: "+e.properties.SERVICE+"<br></div>":"",convertlink(r),a.on({click:function(e){e.preventDefault;var a=$("#feature-content");a.html("<h3>"+t+"</h3>"),a.append(r),$("#featureModal").modal("show"),resize()}})}}})}),i.addLayer(n),i.addTo(map),activeLayers[e]=i,loaded(e),r&&(r===!0?map.fitBounds(n.getBounds()):map.setView(new L.LatLng(40,-100),3))})}function loadGeoJson(e,a,t,r,i,o,s){var n=new L.LayerGroup,l=a;if(s===!1)var d=$("."+e+"-details"),c=$('<div class="details '+e+'-list marker-list" />').insertAfter(d),m=[];var p=$.getJSON(l);p.then(function(a){$(a.features).each(function(a,t){var r=L.geoJson(t,{pointToLayer:function(e,a){var t=L.icon({iconUrl:i,iconRetinaUrl:i,iconSize:[32,32]});return L.marker(a,{icon:t})},onEachFeature:function(e,a){if(e.properties){var r,i;if(r=e.properties.title?"<h3>"+e.properties.title+"</h3>":e.properties.Name?"<h3>"+e.properties.Name+"</h3>":e.properties.name?"<h3>"+e.properties.name+"</h3>":e.properties.LICENSEE?"<h3>"+e.properties.LICENSEE+"</h3>":"",i=e.properties.mag?"<div>Place: "+e.properties.place+"<br>Magnitude: "+e.properties.mag+'<br><a href="'+e.properties.url+'" target="_blank">Click here for more info.</a></div>':e.properties.Description?"<div>"+e.properties.Description+"</div>":e.properties.description?"<div>"+e.properties.description+"</div>":e.properties.desc?"<div>"+e.properties.desc+"</div>":e.properties.FREQUENCY?"<div>FREQUENCY: "+e.properties.FREQUENCY+"<br>CALLSIGN: "+e.properties.CALLSIGN+"<br>SERVICE: "+e.properties.SERVICE+"<br></div>":"",s===!1){var o=t.geometry.coordinates,n=o[0],l=o[1];m.push('<li data-lon="'+n+'"  data-lat="'+l+'">'+r+"</li>")}a.on({click:function(e){e.preventDefault;var a=$("#feature-content");a.html("<h3>"+r+"</h3>"),a.append(i),$("#featureModal").modal("show"),resize()}})}}});n.addLayer(r),n.addTo(map),activeLayers[e]=n,loaded(e)}),s===!1&&($('<h5><i class="fa fa-fw fa-map-marker"></i> Map Markers</h5>').appendTo(c),$("<ol/>",{"class":"markers",html:m.join("")}).appendTo(c),$(".markers li").click(function(){var e=$(this).attr("data-lon"),a=$(this).attr("data-lat");map.setView(new L.LatLng(a,e),15)}))},function(t){loadError(e,a,t)})}function removeImagery(e){var a=activeLayers[e];map.removeLayer(a),delete activeLayers[e]}function disableLayer(e){var a=e.I,t=e.T;if(void 0!==layerEnabled[e.I]){if("nasa-gibs"===t||"cartodb-layer"===t||"wmts"===t||"wms"===t||"base-layer"===t||"arcgis"===t||"arcgis-layer"===t||"arcgis-base-layer"===t){$("."+a+"-sliders").remove();var r=activeLayers[a];map.removeLayer(r),delete activeLayers[a]}else{var r=activeLayers[a];map.removeLayer(r),delete activeLayers[a]}("geojson"===t||"kml"===t)&&($("."+a+"-tree").removeClass("active"),$("."+a+"-list").remove()),delete layerEnabled[a]}}function updateLayer(e){loading(e);var a=me.node(e);a||console.error("missing layer",e);var t=a.G,r=a.L,i=a.M,o=a.MI,s=a.MS,n=a.ML,l=a.Y,d=a.F,c=a.Fz,m=a.P,p=picker.get("select","yyyy-mm-dd");if(!includeOnly)var h=a.Z;c=c?c:"9",d="jpg"===d?"image/jpeg":"image/png",l=l?!0:!1,void 0===layerEnabled[e]&&(layerEnabled[e]=!1,"wms"===a.T?loadWms(e,t,r):"nasa-gibs"===a.T?loadGIBS(e,p,d,c):"wtms"===a.T?loadWmts(e,t,r):"cartodb-layer"===a.T?loadCartoDB(e,t):"base-layer"===a.T?loadOsmLayer(e,t):"arcgis"===a.T||"arcgis-base-layer"===a.T?loadArcGisBasemap(e,t):"arcgis-layer"===a.T?loadArcGisLayer(e,t,r):"geojson"===a.T?loadGeoJson(e,t,n,s,o,h,l):"kml"===a.T?loadKml(e,t,m,h,o,s,n,i):"bing"===a.T?loadBingLayer(e,t,r):console.log(e+" failed to load map type: "+a.T),shareLink())}function newFolderLabel(e,a,t){if(t)var r='<i class="fa fa-fw '+t+'"></i>';else r="";var i=$("<h2>").addClass("toggle").html(r+e.N).click(function(){a.is(":visible")?(a.hide(),i.removeClass("active")):(a.show(),i.addClass("active"))});return i}function initDetails(e,a,t,r,i,o){var s=$('<div class="details '+e+'-content" />').appendTo(t);$('<div class="header"><i class="fa fa-fw fa-info-circle"></i> Layer Details</div><span>'+r+' &bull; <a href="'+i+'" target="_blank" rel="nofollow">More Info</a></span>').appendTo(s),"kml"==a&&$('<div class="header"><i class="fa fa-fw fa-download"></i> Data Source</div><span>Keyhole Markup Language (KML) &bull; <a href="'+o+'">Download</a></span>').appendTo(s),"geojson"==a&&$('<div class="header"><i class="fa fa-fw fa-download"></i> Data Source</div><span>GeoJSON &bull; <a href="'+o+'">Download</a></span>').appendTo(s),"nasa-gibs"==a&&$('<div class="header"><i class="fa fa-fw fa-file-o"></i> Data Source</div><span>Web Map Tile Service (WMTS)</span>').appendTo(s),"wms"==a&&$('<div class="header"><i class="fa fa-fw fa-file-o"></i> Data Source</div><span>Web Mapping Service (WMS)<br><a target="_blank" rel="nofollow" href="'+o+'?request=GetCapabilities&service=WMS">Get Capabilities</a></span>').appendTo(s),"base-layer"==a&&$('<div class="header"><i class="fa fa-fw fa-file-o"></i> Data Source</div><span>OpenStreetMap (OSM) Base Map</span>').appendTo(s),("arcgis"==a||"arcgis-layer"==a)&&$('<div class="header"><i class="fa fa-fw fa-file-o"></i> Data Source</div><span>ArcGIS MapServer<br><a target="_blank" rel="nofollow" href="'+o+'/legend">Map Legend</a> &bull; <a target="_blank" rel="nofollow" href="'+o+'">MapServer Information</a></span>>').appendTo(s),$('<div class="header"><i class="fa fa-share-square-o fa-fw"></i> Share This Layer</div><span>Use this url to share this layer: <a href="'+homeURL+"index.html?layersOn="+e+'" target="_self">Share Link</a><span><div class="header"><i class="fa fa-exclamation-triangle fa-fw"></i> Report Error</div><span>If you are experiencing problems loading this layer, or you would like to suggest corrections, comments, or concerns, please email me using this link: <a href="mailto:jim@climateviewer.com?subject=Climate Viewer broken link - '+e+"&amp;body=Unfortunately this ( "+o+' ) URL is not working properly, please look into it. Sent from http://climateviewer.com/3D/" target="_self">Report Error</a></span>').appendTo(s)}function addTree(e,a,t){var r=me.successors(e);return _.each(r,function(e){var i,r=me.node(e),o=r.I,s=r.T,n=$('<div class="folder" />').html(r);if(r.T){var d=!0;if(d){var w,S,b,k,M,C,T,c=r.G,m=r.S,p=r.U,h=r.H,g=r.NL,u=r.C,f=r.F,v=r.Fz,y=r.Y;y!==!0&&(y=!1),v=v?v:"9",f="jpg"===f?"image/jpeg":"image/png",i=f?$("<div>").data("l",r).attr({id:r.I,"data-format":f,"data-zoom":v}).addClass("lbw "+r.T):$("<div>").data("l",r).attr("id",r.I).addClass("lbw "+r.T),w=$("<div>").addClass("lb").appendTo(i),k=$("<i>").addClass("fa fa-fw fa-folder-o").toggle(function(){0==S.children().length&&initDetails(o,s,S,m,p,c),S.show(),S.focus(),k.removeClass("fa-folder-o").addClass("fa-folder-open-o active"),$("."+r.I+"-sliders").show(),$("."+r.I+"-picker").show()},function(){$("."+r.I+"-sliders").hide(),$("."+r.I+"-picker").hide(),S.hide(),k.removeClass("fa-folder-open-o active").addClass("fa-folder-o")}).appendTo(w),b=$('<i class="fa fa-fw fa-play '+o+'-load"></i>'),h&&b.addClass("large-layer"),g&&b.addClass("new-layer"),"geojson"===r.T&&y===!1&&(M=$('<i title="Expand Marker Tree" class="fa fa-fw fa-sitemap toggle-list '+o+'-tree"></i>'),M.click(function(){setTimeout(function(){$("."+o+"-list").is(":visible")?($("."+o+"-list").hide(),M.removeClass("active")):($("."+o+"-list").show(),M.addClass("active"))})}).appendTo(w)),("nasa-gibs"===r.T||"cartodb-layer"===r.T||"wmts"===r.T||"wms"===r.T||"base-layer"===r.T||"arcgis"===r.T||"arcgis-layer"===r.T||"bing"===r.T)&&(C=$('<i title="Expand Marker Tree" class="fa fa-fw fa-sliders toggle-list '+o+'-tree"></i>'),C.click(function(){setTimeout(function(){$("."+o+"-sliders").is(":visible")?($("."+o+"-sliders").hide(),C.removeClass("show-sliders")):($("."+o+"-sliders").show(),C.addClass("show-sliders"))})}).appendTo(w)),b.toggle(function(){setTimeout(function(){b.hasClass("fa-play")&&(t?updateLayer(o,t):updateLayer(o),T.hasClass("active")||T.addClass("active"),i.addClass("active"),u&&toggleTimeline(!0),"geojson"===r.T&&y===!1&&M.show(),("nasa-gibs"===r.T||"cartodb-layer"===r.T||"wmts"===r.T||"wms"===r.T||"base-layer"===r.T||"arcgis"===r.T||"arcgis-layer"===r.T||"bing"===r.T)&&C.show())})},function(){setTimeout(function(){b.hasClass("fa-check")&&(disableLayer(r),b.removeClass("fa-check active").addClass("fa-play"),T.hasClass("active")&&T.removeClass("active"),i.removeClass("active"),"geojson"===r.T&&y===!1&&M.hide(),("nasa-gibs"===r.T||"cartodb-layer"===r.T||"wmts"===r.T||"wms"===r.T||"base-layer"===r.T||"arcgis"===r.T||"arcgis-layer"===r.T||"bing"===r.T)&&(C.hide(),C.removeClass("show-sliders")))})}).appendTo(w),T=$("<span>").html(r.N).addClass("label"),T.toggle(function(){T.hasClass("fail")||(T.hasClass("active")||T.addClass("active"),b.trigger("click"))},function(){T.hasClass("fail")||(T.hasClass("active")&&T.removeClass("active"),b.trigger("click"))}).appendTo(w),S=$('<div class="ui card '+o+'-details layer-details" />').appendTo(i),S.hide()}}else{var l=r.icon;i=newFolderLabel(r,n,l)}if(null!=i){a.append(i);var A=addTree(r.I,n,t);A.length&&a.append(n)}}),r}function initLayers(e){var a=$("#map-layers");e?_.each(me.sources(),function(t){addTree(t,a,e)}):_.each(me.sources(),function(e){addTree(e,a)})}function shareLink(){function d(e){var a=e,t="r3zn8d",r="b5c2d6d1704074b0741a7449a98e3fcef2790699";$.ajax({url:"https://api-ssl.bitly.com/v3/shorten",data:{longUrl:a,access_token:r,login:t},dataType:"jsonp",success:function(e){var a=e.data.url;$("#result").html('<a href="'+a+'" target="_self">'+a+"</a>")}})}var e="",a="",t=shareURL;$(".geojson.active, .kml.active, .arcgis.active, .wms.active, .wtms.active, .nasa-gibs.active").each(function(){var a=$(this);if(a.hasClass("active")){var t=a.attr("id");e+=t+","}}),$(".cartodb-layer.active, .bing.active, .arcgis-base-layer.active, .base-layer.active").each(function(){var e=$(this);if(e.hasClass("active")){var t=e.attr("id");a+=t+","}});var r=map.getCenter().lat,i=map.getCenter().lng,o=map.getZoom(),s=picker.get("select","yyyy-mm-dd");t+="index.html?",e.length>0&&(e=e.substring(0,e.length-1)),a.length>0&&(a=a.substring(0,a.length-1)),t+="layersOn="+e,t+="&baseLayers="+a,t+="&lat="+r,t+="&lon="+i,t+="&zoom="+o,t+="&date="+s;var n=$(".share-all-layers");n.attr("href",t).html(t);encodeURIComponent(t);d(t)}zip.workerScriptsPath="/lib/zip/";var oneBlob,thisKMZ,urlRegex=/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/;$.fn.exists=function(e){var a=[].slice.call(arguments,1);return this.length&&e.call(this,a),this},$(window).resize(function(){resize()});var _xml={_str2xml:function(e){if(window.ActiveXObject){var a=new ActiveXObject("Microsoft.XMLDOM");a.async="false",a.loadXML(e)}else var t=new DOMParser,a=t.parseFromString(e,"text/xml");return a},_xml2string:function(e){var a=null,t=e.documentElement;return a=void 0==t.xml?(new XMLSerializer).serializeToString(e):t.xml}},map=L.map("map",{center:[30,0],zoom:3,minZoom:2,worldCopyJump:!0,inertia:!1});map.options.crs=L.CRS.EPSG3857,new L.Control.GeoSearch({provider:new L.GeoSearch.Provider.OpenStreetMap}).addTo(map);var homeURL=window.location.protocol+"//"+window.location.host+"/mobile/",shareURL="http://climateviewer.org/mobile/",proxyURL="/proxy.php?",activeLayers={},layerEnabled={},me=Self();nobjectsIn(layers,function(e){},function(e,a,t){me.addEdge(e,a,t)});var today=new Date,yesterday=today.setDate(today.getDate()-1);Date.prototype.getJulian=function(){return Math.floor(this/864e5-this.getTimezoneOffset()/1440+2440587.5)};var date=new Date;date.setDate(date.getDate()-1);var $input=$("#datepicker").pickadate({format:"mmmm d, yyyy",formatSubmit:"yyyy-mm-dd",min:[2012,4,8],max:today,container:"#datepicker-container",closeOnSelect:!0,closeOnClear:!1,selectYears:!0,selectMonths:!0}),picker=$input.pickadate("picker");picker.set("select",yesterday),picker.on({set:function(){var e=picker.get("select","yyyy-mm-dd");$(".nasa-gibs.active").each(function(){loadGIBS($(this).attr("id"),e,$(this).attr("data-format"),$(this).attr("data-zoom"))})}});var start=picker.get("select","yyyy-mm-dd");$(".do-video").one("click",function(){$(".do-video-div").append('<div class="videoWrapper"><iframe width="420" height="236" src="https://www.youtube-nocookie.com/embed/ZwFmez0ef6A" frameborder="0" allowfullscreen></iframe></div>')});var initialLayers=(getURLParameter("layersOn")||"").split(","),initialBaseLayers=(getURLParameter("baseLayers")||"").split(","),disabledLayers=(getURLParameter("layersOff")||"").split(",");""===initialLayers[0]&&(initialLayers=[]),""===disabledLayers[0]&&(disabledLayers=[]);var allLayers=initialLayers.concat(disabledLayers),baseLayers=initialBaseLayers.concat();if(allLayers.length>0){var latView=getURLParameter("lat")||"40",lonView=getURLParameter("lon")||"-100",zoomView=getURLParameter("zoom")||"5",dateView=getURLParameter("date")||start;if(dateView!==start&&picker.set("select",dateView,{format:"yyyy-mm-dd"}),"40"!==latView){var includeOnly=!0;initLayers(includeOnly),map.setView(new L.LatLng(latView,lonView),zoomView)}else initLayers();var shared=$('<div class="folder" style="display: block;"></div>').prependTo("#map-layers");if($('<h2 class="toggle active">Shared Layers</h2>').prependTo("#map-layers").show(),baseLayers.length>0)for(var i=0;i<baseLayers.length;i++)$("."+initialBaseLayers[i]+"-load").click();!$(".cartodb-layer.active, .bing.active, .arcgis-base-layer.active, .base-layer.active").length>0&&$(".Bing_AERIAL_WITH_LABELS-load").click();for(var i=0;i<allLayers.length;i++)$("#"+allLayers[i]).detach().appendTo(shared).show();for(var i=0;i<initialLayers.length;i++)$("."+initialLayers[i]+"-load").click()}else initLayers(),$(".Bing_AERIAL_WITH_LABELS-load").click();$(document).ready(function(){function a(){$(".panel-heading a i.fa-chevron-down").removeClass("fa-chevron-down").addClass("fa-chevron-right")}function t(){$("#datepicker").pickadate("picker").open(),console.log("clicked")}if($(".youtube").each(function(){$(this).css("background-image","url(http://i.ytimg.com/vi/"+this.id+"/sddefault.jpg)"),$(this).append($("<div/>",{"class":"play"})),$(document).delegate("#"+this.id,"click",function(){var e="https://www.youtube.com/embed/"+this.id+"?autoplay=1&autohide=1";$(this).data("params")&&(e+="&"+$(this).data("params"));var a=$("<iframe/>",{frameborder:"0",src:e,width:$(this).width(),height:$(this).height()});$(this).hide(),$("#tutorial").append(a)})}),$(".clear-layers").click(function(e){e.preventDefault(),$("i.active").trigger("click"),$(".Bing_AERIAL_WITH_LABELS-load").click()}),$(".share-active-layers").click(function(e){e.preventDefault(),shareLink(),$("#shareModal").modal()}),$(".about-jim").click(function(){window.location="http://climateviewer.com/rezn8d/"}),$(".reset-view").click(function(e){e.preventDefault(),map.setView([40,-100],3)}),$(".report-tab").click(function(e){e.preventDefault();var a=$(window).width(),t=$(window).height();return 1024>a?(window.open("https://climateviewer.crowdmap.com/","","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height="+t+",width="+a),!1):(window.open("https://climateviewer.crowdmap.com/","","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=800,width=1024"),!1)}),$(".collapse-menu").on("click",function(e){e.preventDefault(),$(".fa-sitemap.active").trigger("click"),$(".fa-folder-open-o.active").trigger("click"),$(".folder h2.active").trigger("click"),$("h2.active").trigger("click")}),$(".top-layers").click(function(e){e.preventDefault(),$(".tab-content").animate({scrollTop:$("#top").offset().top-90},500)}),$(".resources-intro")){var e=$(window).height();$(".resources-intro").height(e)}$("#map").click(function(){$(".control-sidebar").hasClass("control-sidebar-open")&&$("#siderbar-toggle").click()}),$("#welcomeModal").modal().on("shown.bs.modal",function(){$("#chat").html('<iframe src="http://tlk.io/cvnews" class="chat-iframe" style="height:600px"></iframe>')}).on("hidden.bs.modal",function(){$("#chat").html(""),$("#tutorial iframe").remove(),$("#tutorial div.youtube").show(),$(".panel-collapse.in").collapse("hide");var e=$(".panel-heading i");e.hasClass("fa-chevron-down")&&e.removeClass("fa-chevron-down").addClass("fa-chevron-right")}),$("#welcome a").click(function(e){e.preventDefault(),$("#welcomeModal").modal().on("shown.bs.modal",function(){$("#chat").html('<iframe src="http://tlk.io/cvnews" class="chat-iframe" style="height:600px"></iframe>'),$("#sharing-tab").trigger("click")}).on("hidden.bs.modal",function(){$("#chat").html(""),$("#tutorial iframe").remove(),$("#tutorial div.youtube").show(),$(".panel-collapse.in").collapse("hide");var e=$(".panel-heading i");e.hasClass("fa-chevron-down")&&e.removeClass("fa-chevron-down").addClass("fa-chevron-right")})}),$("#active-layers-toggle").toggle(function(){$(".lbw.active").each(function(){var e=$(this).prop("id");$('<span id="'+e+'-holder" style="display: none;" />').insertAfter($(this)),$(this).detach().appendTo("#active-layers")}),$(this).html("Show All Layers"),$(".active-layers-label").show(),$("#active-layers").show(),$(".all-layers-label").hide(),$("#map-layers").hide()},function(){$("#active-layers .lbw.active").each(function(){var e=$(this).prop("id");$(this).detach().insertBefore($("#"+e+"-holder")),$("#"+e+"-holder").remove()}),$(this).html("Show Active Layers"),$(".active-layers-label").hide(),$("#active-layers").hide(),$(".all-layers-label").show(),$("#map-layers").show()}),$(".panel-heading a").on("click",function(){$("i",this).hasClass("fa-chevron-right")?(a(),$("i",this).removeClass("fa-chevron-right").addClass("fa-chevron-down")):(a(),$("i",this).removeClass("fa-chevron-down").addClass("fa-chevron-right"))}),$(".control-sidebar").hasClass("control-sidebar-open")&&$("#siderbar-toggle").addClass("active"),$(".date-icon").click(function(e){e.preventDefault(),e.stopPropagation(),t()}),$(".leaflet-control-geosearch input").detach().addClass("form-control").attr({"aria-describedby":"search",id:"search-input"}).prependTo($(".search form")),$(".content-wrapper").show(),resize()});