"use strict";function isUrlValid(e){return/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(e)}function geturl(e){return e.length>20?e.substr(0,20)+"...":e}function convertlink(e){return e.replace(urlRegex,function(e){return'<a href="'+e+'">'+geturl(e)+"</a>"})}function resize(){var e=$(window).height(),a=$(window).width(),i=767;$(".control-sidebar").height(e-50),$(".main-sidebar").height(e-100),$(".tab-content").height(e-100),$("html").height(e),$("body").height(e),$(".content-wrapper").height(e-50),$("#map").height(e-50).width(a),i>a&&($("#siderbar-toggle i").removeClass("fa-chevron-left").addClass("fa-chevron-right"),$(".control-sidebar").removeClass("control-sidebar-open"))}function getURLParameter(e){for(var a=decodeURIComponent(window.location.search.substring(1)),i=a.split("&"),r=0;r<i.length;r++){var t=i[r].split("=");if(t[0]==e)return t[1]}}function loading(e){$("."+e+"-load").removeClass("fa-play").addClass("fa-spinner fa-spin loading active")}function loaded(e){$("."+e+"-load").removeClass("fa-spinner fa-spin loading").addClass("fa-check")}function loadError(e,a,i){var r=$("#"+e);$('<div class="ui card layer-sliders" style="display:block"><div class="content"><div class="ui divided list"><div class="item"><i class="circular inverted warning icon"></i><div class="content"><div class="header">Load Failed</div>Please use <a href="mailto:jim@climateviewer.com?subject=Climate Viewer broken link - '+e+"&amp;body=Unfortunately this ( "+a+" ) URL is not working properly due to ( "+i+' ), please look into it.  Sent from http://climateviewer.com/mobile/" target="_blank">this link</a> to report this error.<br><br><strong>ERROR:</strong> '+i+"</div></div></div></div>").appendTo(r);var t=$("."+e+"-load"),s=$("#"+e+" span");t.removeClass("spinner loading").addClass("close fail"),s.removeClass("active").addClass("fail")}function NSlider(e){var a=e.src;e.mod;e=e||{},e.element||(e.element=$('<div class="item slider"></div>')),e.min||(e.min=0),e.max||(e.max=1),e.start||(e.start=1),e.label||(e.label=""),$('<div class="label">'+e.label+"</div>").appendTo(e.element);var r=$('<input class="'+e.label+'" type="range">').appendTo(e.element),t=e.start/e.max*100;return r.attr("min",0),r.attr("max",100),r.attr("step",1),r.attr("value",t),r.on("change",function(){var i=r.val(),t=(i/100).toFixed(2),s=e.max*t;"opacity"==e.label&&a.setOpacity(s)}),e.element}function loadSliders(e,a,i){var r=$("#"+a+" .lb"),t=$('<div class="details '+a+'-sliders layer-sliders" />').insertAfter(r),s=$('<div class="slider-content" />').appendTo(t),l=$('<div class="ui divided list" />').appendTo(s);NSlider({label:"opacity",src:e}).appendTo(l);var o=$("."+a+"-details");if(i){var n=$("."+a+"-picker");o.is(":visible")&&(t.show(),n.show())}else o.is(":visible")&&t.show();loaded(a)}function loadGIBS(e,a){var i="//map1{s}.vis.earthdata.nasa.gov/wmts-webmerc/{layer}/default/{time}/{tileMatrixSet}/{z}/{y}/{x}.jpg";activeLayers[e]&&removeImagery(e);var r=new L.LayerGroup,t=L.tileLayer(i,{layer:e,tileMatrixSet:"GoogleMapsCompatible_Level9",maxZoom:9,time:a,bounds:[[-85.0511287776,-179.999999975],[85.0511287776,179.999999975]],attribution:"<a href='https://wiki.earthdata.nasa.gov/display/GIBS' target='_blank'>NASA EOSDIS GIBS</a>&nbsp;&nbsp;&nbsp;<a href='https://github.com/nasa-gibs/web-examples/blob/release/examples/leaflet/webmercator-epsg3857.js' target='_blank'>View Source</a>"});r.addLayer(t),r.addTo(map),activeLayers[e]=r,$("."+e+"-sliders").remove(),loadSliders(t,e)}function loadWmts(e,a,i){var r=new L.LayerGroup,t=viewer.imageryLayers.addImageryProvider(new Cesium.WebMapTileServiceImageryProvider({url:a,layers:i,style:"",format:"image/png",tileMatrixSetID:"GoogleMapsCompatible_Level9",maximumLevel:9,tileWidth:256,tileHeight:256,tilingScheme:new Cesium.WebMercatorTilingScheme}));r.addLayer(t),r.addTo(map),activeLayers[e]=r,loadSliders(t,e)}function loadWms(e,a,i){var r=new L.LayerGroup,t=L.tileLayer.wms(a,{layers:i,format:"image/png",transparent:!0}).setZIndex("200");r.addLayer(t),r.addTo(map),activeLayers[e]=r,loadSliders(t,e)}function loadOsmLayer(e,a){var i=new L.LayerGroup,r=L.tileLayer(a+"{z}/{x}/{y}.png",{zIndex:2,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions" target="_blank">CartoDB</a>',subdomains:"abcd",maxZoom:19});i.addLayer(r),i.addTo(map),activeLayers[e]=i,loadSliders(r,e)}function loadCartoDB(e,a){var i=new L.LayerGroup,r=L.tileLayer(a,{zIndex:1,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',maxZoom:19});i.addLayer(r),i.addTo(map),activeLayers[e]=i,loadSliders(r,e)}function loadBingLayer(e,a){var r,i=new L.LayerGroup,t="AiQDjsWpddVOFEnVY6j4Jb0S0Hoy9QMa30rvbZT1A8qd0it10NkYAgvb5sa3OeLw";r="AERIAL"==a?new L.BingLayer(t,{type:"Aerial"}):"AERIAL_WITH_LABELS"==a?new L.BingLayer(t,{type:"AerialWithLabels"}):new L.BingLayer(t,{type:"Road"}),i.addLayer(r),i.addTo(map),activeLayers[e]=i,loadSliders(r,e)}function loadArcGisLayer(e,a,i){var r=new L.LayerGroup,t=L.esri.dynamicMapLayer({url:a,layers:[i],opacity:1,useCors:!1});t.bindPopup(function(e,a){var r,t,i=a.features[0];if(t=$("<p />"),r="<h3>Details</h3>",e||0===a.features.length)return!1;var s=$("#feature-content"),l=$("<p/>").appendTo(s);$.map(i.properties,function(e,a){$("<strong>"+a+"</strong>&nbsp;&bull;&nbsp;<span>"+(isUrlValid(e)?'<a href="'+e+'" target="_blank">'+e+"</a>":e)+"</span><br>").appendTo(l)}),$("#featureModal").modal("show").modal({onHidden:function(){$(".null").remove()}})}),r.addLayer(t),r.addTo(map),activeLayers[e]=r,loadSliders(t,e)}function loadArcGisBasemap(e,a){var i=new L.LayerGroup,r=L.tileLayer(a+"/tile/{z}/{y}/{x}",{zIndex:2,attribution:"Copyright:Â© 2013 ESRI, i-cubed, GeoEye",subdomains:"abcd",maxZoom:19});i.addLayer(r),i.addTo(map),activeLayers[e]=i,loadSliders(r,e)}function loadKml(e,a,i,r){var l,t=new L.LayerGroup,s=proxyURL+a;l=i?s:a;var o;o=l.indexOf(".kmz")>=0||l.indexOf("MapServer")>=0?new L.KMZ(l,{imageOverlayBoundingBoxCreatePopUp:!0,imageOverlayBoundingBoxDrawOptions:{stroke:!0,weight:2,fillOpacity:.05,clickable:!0}},"KMZ"):new L.KML(l,{async:!0}),o.on("loaded",function(a){$(a.features).each(function(e,a){L.KML(a,{onEachFeature:function(e,a){if(e.properties){var i,r;i=e.properties.title?"<h3>"+e.properties.title+"</h3>":e.properties.Name?"<h3>"+e.properties.Name+"</h3>":e.properties.name?"<h3>"+e.properties.name+"</h3>":e.properties.LICENSEE?"<h3>"+e.properties.LICENSEE+"</h3>":"",r=e.properties.mag?"<div>Place: "+e.properties.place+"<br>Magnitude: "+e.properties.mag+'<br><a href="'+e.properties.url+'" target="_blank">Click here for more info.</a></div>':e.properties.Description?"<div>"+e.properties.Description+"</div>":e.properties.description?"<div>"+e.properties.description+"</div>":e.properties.desc?"<div>"+e.properties.desc+"</div>":e.properties.FREQUENCY?"<div>FREQUENCY: "+e.properties.FREQUENCY+"<br>CALLSIGN: "+e.properties.CALLSIGN+"<br>SERVICE: "+e.properties.SERVICE+"<br></div>":"",convertlink(r),a.on({click:function(e){e.preventDefault;var a=$("#feature-content");a.html("<h3>"+i+"</h3>"),a.append(r),$("#featureModal").modal("show"),resize()}})}}})}),t.addLayer(o),t.addTo(map),activeLayers[e]=t,loaded(e),r&&(r===!0?map.fitBounds(o.getBounds()):map.setView(new L.LatLng(40,-100),3))})}function loadGeoJson(e,a,i,r,t,s,l){var o=new L.LayerGroup,n=a;if(l===!1)var d=$("."+e+"-details"),c=$('<div class="details '+e+'-list marker-list" />').insertAfter(d),v=[];var f=$.getJSON(n);f.then(function(a){$(a.features).each(function(a,i){var r=L.geoJson(i,{pointToLayer:function(e,a){var i=L.icon({iconUrl:t,iconRetinaUrl:t,iconSize:[32,32]});return L.marker(a,{icon:i})},onEachFeature:function(e,a){if(e.properties){var r,t;if(r=e.properties.title?"<h3>"+e.properties.title+"</h3>":e.properties.Name?"<h3>"+e.properties.Name+"</h3>":e.properties.name?"<h3>"+e.properties.name+"</h3>":e.properties.LICENSEE?"<h3>"+e.properties.LICENSEE+"</h3>":"",t=e.properties.mag?"<div>Place: "+e.properties.place+"<br>Magnitude: "+e.properties.mag+'<br><a href="'+e.properties.url+'" target="_blank">Click here for more info.</a></div>':e.properties.Description?"<div>"+e.properties.Description+"</div>":e.properties.description?"<div>"+e.properties.description+"</div>":e.properties.desc?"<div>"+e.properties.desc+"</div>":e.properties.FREQUENCY?"<div>FREQUENCY: "+e.properties.FREQUENCY+"<br>CALLSIGN: "+e.properties.CALLSIGN+"<br>SERVICE: "+e.properties.SERVICE+"<br></div>":"",l===!1){var s=i.geometry.coordinates,o=s[0],n=s[1];v.push('<li data-lon="'+o+'"  data-lat="'+n+'">'+r+"</li>")}a.on({click:function(e){e.preventDefault;var a=$("#feature-content");a.html("<h3>"+r+"</h3>"),a.append(t),$("#featureModal").modal("show"),resize()}})}}});o.addLayer(r),o.addTo(map),activeLayers[e]=o,loaded(e)}),l===!1&&($('<h5><i class="fa fa-fw fa-map-marker"></i> Map Markers</h5>').appendTo(c),$("<ol/>",{"class":"markers",html:v.join("")}).appendTo(c),$(".markers li").click(function(){var e=$(this).attr("data-lon"),a=$(this).attr("data-lat");map.setView(new L.LatLng(a,e),15)}))},function(i){loadError(e,a,i)})}function removeImagery(e){var a=activeLayers[e];map.removeLayer(a),delete activeLayers[e]}function disableLayer(e){var a=e.I,i=e.T;if(void 0!==layerEnabled[e.I]){if("nasa-gibs"===i||"cartodb-layer"===i||"wmts"===i||"wms"===i||"base-layer"===i||"arcgis"===i||"arcgis-layer"===i||"arcgis-base-layer"===i){$("."+a+"-sliders").remove();var r=activeLayers[a];map.removeLayer(r),delete activeLayers[a]}else{var r=activeLayers[a];map.removeLayer(r),delete activeLayers[a]}("geojson"===i||"kml"===i)&&($("."+a+"-tree").removeClass("active"),$("."+a+"-list").remove()),delete layerEnabled[a]}}function updateLayer(e){loading(e);var a=me.node(e);a||console.error("missing layer",e);var i=a.G,r=a.L,t=a.M,s=a.MI,l=a.MS,o=a.ML,n=a.Y,d=a.P,c=picker.get("select","yyyy-mm-dd");if(!includeOnly)var v=a.Z;n=n?!0:!1,void 0===layerEnabled[e]&&(layerEnabled[e]=!1,"wms"===a.T?loadWms(e,i,r):"wtms"===a.T?loadGIBS(e):"nasa-gibs"===a.T?loadGIBS(e,c):"wtms"===a.T?loadWmts(e,i,r):"cartodb-layer"===a.T?loadCartoDB(e,i):"base-layer"===a.T?loadOsmLayer(e,i):"arcgis"===a.T||"arcgis-base-layer"===a.T?loadArcGisBasemap(e,i):"arcgis-layer"===a.T?loadArcGisLayer(e,i,r):"geojson"===a.T?loadGeoJson(e,i,o,l,s,v,n):"kml"===a.T?loadKml(e,i,d,v,s,l,o,t):"bing"===a.T?loadBingLayer(e,i,r):console.log(e+" failed to load map type: "+a.T),shareLink())}function newFolderLabel(e,a,i){if(i)var r='<i class="fa fa-fw '+i+'"></i>';else r="";var t=$("<h2>").addClass("toggle").html(r+e.N).click(function(){a.is(":visible")?(a.hide(),t.removeClass("active")):(a.show(),t.addClass("active"))});return t}function initDetails(e,a,i,r,t,s){var l=$('<div class="details '+e+'-content" />').appendTo(i);$('<div class="header"><i class="fa fa-fw fa-info-circle"></i> Layer Details</div><span>'+r+' &bull; <a href="'+t+'" target="_blank" rel="nofollow">More Info</a></span>').appendTo(l),"kml"==a&&$('<div class="header"><i class="fa fa-fw fa-download"></i> Data Source</div><span>Keyhole Markup Language (KML) &bull; <a href="'+s+'">Download</a></span>').appendTo(l),"geojson"==a&&$('<div class="header"><i class="fa fa-fw fa-download"></i> Data Source</div><span>GeoJSON &bull; <a href="'+s+'">Download</a></span>').appendTo(l),"nasa-gibs"==a&&$('<div class="header"><i class="fa fa-fw fa-file-o"></i> Data Source</div><span>Web Map Tile Service (WMTS)</span>').appendTo(l),"wms"==a&&$('<div class="header"><i class="fa fa-fw fa-file-o"></i> Data Source</div><span>Web Mapping Service (WMS)<br><a target="_blank" rel="nofollow" href="'+s+'?request=GetCapabilities&service=WMS">Get Capabilities</a></span>').appendTo(l),"base-layer"==a&&$('<div class="header"><i class="fa fa-fw fa-file-o"></i> Data Source</div><span>OpenStreetMap (OSM) Base Map</span>').appendTo(l),("arcgis"==a||"arcgis-layer"==a)&&$('<div class="header"><i class="fa fa-fw fa-file-o"></i> Data Source</div><span>ArcGIS MapServer<br><a target="_blank" rel="nofollow" href="'+s+'/legend">Map Legend</a> &bull; <a target="_blank" rel="nofollow" href="'+s+'">MapServer Information</a></span>>').appendTo(l),$('<div class="header"><i class="fa fa-share-square-o fa-fw"></i> Share This Layer</div><span>Use this url to share this layer: <a href="'+homeURL+"index.html?layersOn="+e+'" target="_self">Share Link</a><span><div class="header"><i class="fa fa-exclamation-triangle fa-fw"></i> Report Error</div><span>If you are experiencing problems loading this layer, or you would like to suggest corrections, comments, or concerns, please email me using this link: <a href="mailto:jim@climateviewer.com?subject=Climate Viewer broken link - '+e+"&amp;body=Unfortunately this ( "+s+' ) URL is not working properly, please look into it. Sent from http://climateviewer.com/3D/" target="_self">Report Error</a></span>').appendTo(l)}function addTree(e,a,i){var r=me.successors(e);return _.each(r,function(e){var t,r=me.node(e),s=r.I,l=r.T,o=$('<div class="folder" />').html(r);if(r.T){var d=!0;if(d){var g,y,w,b,C,L,T,c=r.G,v=r.S,f=r.U,m=r.H,u=r.NL,p=r.C,h=r.Y;h!==!0&&(h=!1),t=$("<div>").data("l",r).attr("id",r.I).addClass("lbw").addClass(r.T),g=$("<div>").addClass("lb").appendTo(t),b=$("<i>").addClass("fa fa-fw fa-folder-o").toggle(function(){0==y.children().length&&initDetails(s,l,y,v,f,c),y.show(),y.focus(),b.removeClass("fa-folder-o").addClass("fa-folder-open-o active"),$("."+r.I+"-sliders").show(),$("."+r.I+"-picker").show()},function(){$("."+r.I+"-sliders").hide(),$("."+r.I+"-picker").hide(),y.hide(),b.removeClass("fa-folder-open-o active").addClass("fa-folder-o")}).appendTo(g),w=$('<i class="fa fa-fw fa-play '+s+'-load"></i>'),m&&w.addClass("large-layer"),u&&w.addClass("new-layer"),"geojson"===r.T&&h===!1&&(C=$('<i title="Expand Marker Tree" class="fa fa-fw fa-sitemap toggle-list '+s+'-tree"></i>'),C.click(function(){setTimeout(function(){$("."+s+"-list").is(":visible")?($("."+s+"-list").hide(),C.removeClass("active")):($("."+s+"-list").show(),C.addClass("active"))})}).appendTo(g)),("nasa-gibs"===r.T||"cartodb-layer"===r.T||"wmts"===r.T||"wms"===r.T||"base-layer"===r.T||"arcgis"===r.T||"arcgis-layer"===r.T||"bing"===r.T)&&(L=$('<i title="Expand Marker Tree" class="fa fa-fw fa-sliders toggle-list '+s+'-tree"></i>'),L.click(function(){setTimeout(function(){$("."+s+"-sliders").is(":visible")?($("."+s+"-sliders").hide(),L.removeClass("show-sliders")):($("."+s+"-sliders").show(),L.addClass("show-sliders"))})}).appendTo(g)),w.toggle(function(){setTimeout(function(){w.hasClass("fa-play")&&(i?updateLayer(s,i):updateLayer(s),T.hasClass("active")||T.addClass("active"),t.addClass("active"),p&&toggleTimeline(!0),"geojson"===r.T&&h===!1&&C.show(),("nasa-gibs"===r.T||"cartodb-layer"===r.T||"wmts"===r.T||"wms"===r.T||"base-layer"===r.T||"arcgis"===r.T||"arcgis-layer"===r.T||"bing"===r.T)&&L.show())})},function(){setTimeout(function(){w.hasClass("fa-check")&&(disableLayer(r),w.removeClass("fa-check active").addClass("fa-play"),T.hasClass("active")&&T.removeClass("active"),t.removeClass("active"),"geojson"===r.T&&h===!1&&C.hide(),("nasa-gibs"===r.T||"cartodb-layer"===r.T||"wmts"===r.T||"wms"===r.T||"base-layer"===r.T||"arcgis"===r.T||"arcgis-layer"===r.T||"bing"===r.T)&&(L.hide(),L.removeClass("show-sliders")))})}).appendTo(g),T=$("<span>").html(r.N).addClass("label"),T.toggle(function(){T.hasClass("fail")||(T.hasClass("active")||T.addClass("active"),w.trigger("click"))},function(){T.hasClass("fail")||(T.hasClass("active")&&T.removeClass("active"),w.trigger("click"))}).appendTo(g),y=$('<div class="ui card '+s+'-details layer-details" />').appendTo(t),y.hide()}}else{var n=r.icon;t=newFolderLabel(r,o,n)}if(null!=t){a.append(t);var k=addTree(r.I,o,i);k.length&&a.append(o)}}),r}function initLayers(e){var a=$("#map-layers");e?_.each(me.sources(),function(i){addTree(i,a,e)}):_.each(me.sources(),function(e){addTree(e,a)})}function shareLink(){function d(e){var a=e,i="r3zn8d",r="b5c2d6d1704074b0741a7449a98e3fcef2790699";$.ajax({url:"https://api-ssl.bitly.com/v3/shorten",data:{longUrl:a,access_token:r,login:i},dataType:"jsonp",success:function(e){var a=e.data.url;$("#result").html('<a href="'+a+'" target="_self">'+a+"</a>")}})}var e="",a="",i=shareURL;$(".geojson.active, .kml.active, .arcgis.active, .wms.active, .wtms.active, .nasa-gibs.active").each(function(){var a=$(this);if(a.hasClass("active")){var i=a.attr("id");e+=i+","}}),$(".cartodb-layer.active, .bing.active, .arcgis-base-layer.active, .base-layer.active").each(function(){var e=$(this);if(e.hasClass("active")){var i=e.attr("id");a+=i+","}});var r=map.getCenter().lat,t=map.getCenter().lng,s=map.getZoom(),l=picker.get("select","yyyy-mm-dd");i+="index.html?",e.length>0&&(e=e.substring(0,e.length-1)),a.length>0&&(a=a.substring(0,a.length-1)),i+="layersOn="+e,i+="&baseLayers="+a,i+="&lat="+r,i+="&lon="+t,i+="&zoom="+s,i+="&date="+l;var o=$(".share-all-layers");o.attr("href",i).html(i);encodeURIComponent(i);d(i)}zip.workerScriptsPath="/lib/zip/";var oneBlob,thisKMZ,urlRegex=/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/;$.fn.exists=function(e){var a=[].slice.call(arguments,1);return this.length&&e.call(this,a),this},$(window).resize(function(){resize()});var _xml={_str2xml:function(e){if(window.ActiveXObject){var a=new ActiveXObject("Microsoft.XMLDOM");a.async="false",a.loadXML(e)}else var i=new DOMParser,a=i.parseFromString(e,"text/xml");return a},_xml2string:function(e){var a=null,i=e.documentElement;return a=void 0==i.xml?(new XMLSerializer).serializeToString(e):i.xml}},map=L.map("map",{center:[30,0],zoom:3,minZoom:2,worldCopyJump:!0,inertia:!1});map.options.crs=L.CRS.EPSG3857,new L.Control.GeoSearch({provider:new L.GeoSearch.Provider.OpenStreetMap}).addTo(map);var homeURL=window.location.protocol+"//"+window.location.host+"/mobile/",shareURL="http://climateviewer.org/mobile/",proxyURL="/proxy.php?",activeLayers={},layerEnabled={},me=Self();nobjectsIn(layers,function(e){},function(e,a,i){me.addEdge(e,a,i)});var today=new Date,yesterday=today.setDate(today.getDate()-1);Date.prototype.getJulian=function(){return Math.floor(this/864e5-this.getTimezoneOffset()/1440+2440587.5)};var date=new Date;date.setDate(date.getDate()-1);var $input=$("#datepicker").pickadate({format:"mmmm d, yyyy",formatSubmit:"yyyy-mm-dd",min:[2012,4,8],max:today,container:"#datepicker-container",closeOnSelect:!0,closeOnClear:!1,selectYears:!0,selectMonths:!0}),picker=$input.pickadate("picker");picker.set("select",yesterday),picker.on({set:function(){var e=picker.get("select","yyyy-mm-dd");$(".nasa-gibs.active").each(function(){loadGIBS($(this).attr("id"),e)})}});var start=picker.get("select","yyyy-mm-dd");$(".do-video").one("click",function(){$(".do-video-div").append('<div class="videoWrapper"><iframe width="420" height="236" src="https://www.youtube-nocookie.com/embed/ZwFmez0ef6A" frameborder="0" allowfullscreen></iframe></div>')});var initialLayers=(getURLParameter("layersOn")||"").split(","),initialBaseLayers=(getURLParameter("baseLayers")||"").split(","),disabledLayers=(getURLParameter("layersOff")||"").split(",");""===initialLayers[0]&&(initialLayers=[]),""===disabledLayers[0]&&(disabledLayers=[]);var allLayers=initialLayers.concat(disabledLayers),baseLayers=initialBaseLayers.concat();if(allLayers.length>0){var latView=getURLParameter("lat")||"40",lonView=getURLParameter("lon")||"-100",zoomView=getURLParameter("zoom")||"5",dateView=getURLParameter("date")||start;if(dateView!==start&&picker.set("select",dateView,{format:"yyyy-mm-dd"}),"40"!==latView){var includeOnly=!0;initLayers(includeOnly),map.setView(new L.LatLng(latView,lonView),zoomView)}else initLayers();var shared=$('<div class="folder" style="display: block;"></div>').prependTo("#map-layers");if($('<h2 class="toggle active">Shared Layers</h2>').prependTo("#map-layers").show(),baseLayers.length>0)for(var i=0;i<baseLayers.length;i++)$("."+initialBaseLayers[i]+"-load").click();for(var i=0;i<allLayers.length;i++)$("#"+allLayers[i]).detach().appendTo(shared).show();for(var i=0;i<initialLayers.length;i++)$("."+initialLayers[i]+"-load").click()}else initLayers();$(document).ready(function(){function a(){$(".panel-heading a i.fa-chevron-down").removeClass("fa-chevron-down").addClass("fa-chevron-right")}function i(){$("#datepicker").pickadate("picker").open(),console.log("clicked")}if($(".youtube").each(function(){$(this).css("background-image","url(http://i.ytimg.com/vi/"+this.id+"/sddefault.jpg)"),$(this).append($("<div/>",{"class":"play"})),$(document).delegate("#"+this.id,"click",function(){var e="https://www.youtube.com/embed/"+this.id+"?autoplay=1&autohide=1";$(this).data("params")&&(e+="&"+$(this).data("params"));var a=$("<iframe/>",{frameborder:"0",src:e,width:$(this).width(),height:$(this).height()});$(this).hide(),$("#tutorial").append(a)})}),$(".clear-layers").click(function(e){e.preventDefault(),$("i.active").trigger("click"),$(".Bing_AERIAL_WITH_LABELS-load").click()}),$(".share-active-layers").click(function(e){e.preventDefault(),shareLink(),$("#shareModal").modal()}),$(".about-jim").click(function(){window.location="http://climateviewer.com/rezn8d/"}),$(".reset-view").click(function(e){e.preventDefault(),map.setView([40,-100],3)}),$(".report-tab").click(function(e){e.preventDefault();var a=$(window).width(),i=$(window).height();return 1024>a?(window.open("https://climateviewer.crowdmap.com/","","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height="+i+",width="+a),!1):(window.open("https://climateviewer.crowdmap.com/","","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=800,width=1024"),!1)}),$(".collapse-menu").on("click",function(e){e.preventDefault(),$(".fa-sitemap.active").trigger("click"),$(".fa-folder-open-o.active").trigger("click"),$(".folder h2.active").trigger("click"),$("h2.active").trigger("click")}),$(".top-layers").click(function(e){e.preventDefault(),$(".tab-content").animate({scrollTop:$("#top").offset().top-90},500)}),$(".resources-intro")){var e=$(window).height();$(".resources-intro").height(e)}$("#map").click(function(){$(".control-sidebar").hasClass("control-sidebar-open")&&$("#siderbar-toggle").click()}),$("#welcomeModal").modal().on("shown.bs.modal",function(){$("#chat").html('<iframe src="http://tlk.io/cvnews" class="chat-iframe" style="height:600px"></iframe>')}).on("hidden.bs.modal",function(){$("#chat").html(""),$("#tutorial iframe").remove(),$("#tutorial div.youtube").show(),$(".panel-collapse.in").collapse("hide");var e=$(".panel-heading i");e.hasClass("fa-chevron-down")&&e.removeClass("fa-chevron-down").addClass("fa-chevron-right")}),$("#welcome a").click(function(e){e.preventDefault(),$("#welcomeModal").modal().on("shown.bs.modal",function(){$("#chat").html('<iframe src="http://tlk.io/cvnews" class="chat-iframe" style="height:600px"></iframe>')}).on("hidden.bs.modal",function(){$("#chat").html(""),$("#tutorial iframe").remove(),$("#tutorial div.youtube").show(),$(".panel-collapse.in").collapse("hide");var e=$(".panel-heading i");e.hasClass("fa-chevron-down")&&e.removeClass("fa-chevron-down").addClass("fa-chevron-right")})}),$("#active-layers-toggle").toggle(function(){$(".lbw.active").each(function(){var e=$(this).prop("id");$('<span id="'+e+'-holder" style="display: none;" />').insertAfter($(this)),$(this).detach().appendTo("#active-layers")}),$(this).html("Show All Layers"),$(".active-layers-label").show(),$("#active-layers").show(),$(".all-layers-label").hide(),$("#map-layers").hide()},function(){$("#active-layers .lbw.active").each(function(){var e=$(this).prop("id");$(this).detach().insertBefore($("#"+e+"-holder")),$("#"+e+"-holder").remove()}),$(this).html("Show Active Layers"),$(".active-layers-label").hide(),$("#active-layers").hide(),$(".all-layers-label").show(),$("#map-layers").show()}),$(".panel-heading a").on("click",function(){$("i",this).hasClass("fa-chevron-right")?(a(),$("i",this).removeClass("fa-chevron-right").addClass("fa-chevron-down")):(a(),$("i",this).removeClass("fa-chevron-down").addClass("fa-chevron-right"))}),$(".control-sidebar").hasClass("control-sidebar-open")&&$("#siderbar-toggle").addClass("active"),$(".date-icon").click(function(e){e.preventDefault(),e.stopPropagation(),i()}),$(".leaflet-control-geosearch input").detach().addClass("form-control").attr({"aria-describedby":"search",id:"search-input"}).prependTo($(".search form")),!$(".cartodb-layer.active, .bing.active, .arcgis-base-layer.active, .base-layer.active").length>0&&$(".Bing_AERIAL_WITH_LABELS-load").click(),$(".content-wrapper").show(),resize()});